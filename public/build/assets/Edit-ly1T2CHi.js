import{d as ee,u as te,a as se,w as T,r as $,c as ae,b as l,e as t,f as e,h as oe,g as r,l as le,j as c,t as i,i as m,m as _,k as V,F as ie,p as ne,s as g,q as S}from"./app-D6ZExuG4.js";import{_ as de}from"./Heading.vue_vue_type_script_setup_true_lang-C_Qaqaft.js";import{_ as re}from"./index-MxVPBNtp.js";import{_ as x}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BAMJN8k7.js";import{_ as O,a as N,b as B,c as q}from"./CardTitle.vue_vue_type_script_setup_true_lang-D4csAZoX.js";import{_ as A}from"./CardDescription.vue_vue_type_script_setup_true_lang-Cyfhoq0p.js";import{_ as ce}from"./Checkbox.vue_vue_type_script_setup_true_lang-CsdWR3ey.js";import{_ as ue,a as me,b as _e,c as fe,d as pe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CgDzptfY.js";import{_ as ve}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CmMndOaZ.js";import{D as w,U as L,_ as ke}from"./models-CJdPgyWg.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-B9Upw0KD.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-B7C0xePR.js";import{_ as P}from"./Select.vue_vue_type_script_setup_true_lang-CEEQHg8s.js";import{_ as be}from"./StatusBadge.vue_vue_type_script_setup_true_lang-DTLVhpcY.js";import{_ as ge}from"./Textarea.vue_vue_type_script_setup_true_lang-Bl9lXqTK.js";import{t as xe,F as K,d as he,v as ye,j as U,x as $e}from"./AppLayout.vue_vue_type_script_setup_true_lang-DhQ7Babn.js";import{p as Ve,s as we,d as Ce}from"./index-PwX051BP.js";import{A as De}from"./arrow-left-BcIyfv1Q.js";import{E as Se}from"./eye-Cfy1nj4J.js";import{T as R}from"./trash-2-DQ56K_0i.js";import{S as ze}from"./save-1JsZ_0ZU.js";import"./index-Dnaiof97.js";import"./useForwardPropsEmits-BgLpAiDO.js";import"./VisuallyHidden-D-NgPM13.js";import"./VisuallyHiddenInput-B9UHQZYS.js";import"./useForwardExpose-6n7ayWvE.js";import"./check-C3XzR5eS.js";import"./createLucideIcon-BXqO2veZ.js";import"./chevron-down-DKASTZ1i.js";import"./index-BDqSilVs.js";const Ue={class:"flex h-full flex-1 flex-col gap-6 p-6"},je={class:"flex items-center gap-4"},Ee={class:"grid gap-4 sm:grid-cols-2"},Fe={class:"space-y-2"},Te={class:"text-xs text-muted-foreground"},Oe={class:"space-y-2"},Ne={key:0,class:"text-sm text-destructive"},Be={class:"space-y-2"},qe={key:0,class:"text-sm text-destructive"},Ae={class:"space-y-2"},Le={key:0,class:"text-sm text-destructive"},Me={class:"space-y-2 sm:col-span-2"},Pe={key:0,class:"text-sm text-destructive"},Ke={class:"flex items-center space-x-2"},Re={class:"flex items-center justify-between"},Xe={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},Ye={class:"flex items-center justify-between"},Ge={key:0,class:"space-y-3"},He={class:"rounded-md bg-muted/50 dark:bg-muted/20 p-3 border border-border/50 dark:border-border/30"},Ie={class:"flex items-start gap-2"},Je={class:"flex-1 text-sm font-medium text-foreground dark:text-foreground/90 break-all leading-relaxed"},Qe={class:"flex gap-2"},We=["href"],Ze={key:1,class:"space-y-2"},et={key:0,class:"flex items-center gap-2 text-xs text-primary dark:text-primary/90 animate-pulse"},tt={class:"mt-4 text-xs text-muted-foreground"},st={class:"flex items-center justify-end gap-4"},Ft=ee({__name:"Edit",props:{ticket:{},vendors:{},contracts:{}},setup(C){const u=C,{t:s}=te(),f=xe(),X=g(()=>[{title:s("nav.tickets"),href:ye().url},{title:u.ticket.number,href:U(u.ticket.id).url},{title:s("common.edit"),href:"#"}]),Y=g(()=>o.vendor_id?u.contracts.filter(n=>n.vendor_id===o.vendor_id):u.contracts),G=g(()=>u.vendors.map(n=>({value:n.id,label:`${n.code} - ${n.name}`}))),H=g(()=>Y.value.map(n=>({value:n.id,label:n.number}))),o=se({date:u.ticket.date,contract_id:u.ticket.contract_id,vendor_id:u.ticket.vendor_id,notes:u.ticket.notes??"",is_active:u.ticket.is_active});T(()=>o.vendor_id,n=>{if(n&&o.contract_id){const d=u.contracts.find(a=>a.id===o.contract_id);d&&d.vendor_id!==n&&(o.contract_id=null)}}),T(()=>o.contract_id,n=>{if(n){const d=u.contracts.find(a=>a.id===n);d&&(o.vendor_id=d.vendor_id)}});function j(){S.get(U(u.ticket.id).url)}function I(){o.put($e(u.ticket.id).url,{preserveScroll:!0,onSuccess:()=>{f.success(s("tickets.updated_successfully")),S.visit(U(u.ticket.id).url)},onError:()=>{f.error(s("tickets.update_failed"))}})}const E=$(Object.fromEntries(w.map(n=>[n,null]))),D=$(null),k=$(null),h=$(!1),b=$(null),F=g(()=>u.ticket.documents??[]),z=g(()=>{const n=w.filter(d=>F.value.some(a=>a.type===d)).length;return{count:n,total:w.length,isComplete:n>=w.length}});function p(n){return F.value.find(d=>d.type===n)}async function J(n,d){if(d){D.value=n;try{const a=new FormData;a.append("file",d),a.append("ticket_id",String(u.ticket.id)),a.append("type",n);const y=await fetch(we().url,{method:"POST",body:a,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content??""}});if(y.ok)f.success(s("documents.uploaded_successfully")),S.reload({only:["ticket"]});else{const Z=await y.json();f.error(Z.message||s("documents.upload_failed"))}}catch{f.error(s("documents.upload_failed"))}finally{D.value=null,E.value[n]=null}}}function Q(n){b.value=n,h.value=!0}function W(){b.value&&(k.value=b.value.id,S.delete(Ce(b.value.id).url,{preserveScroll:!0,onSuccess:()=>{f.success(s("documents.deleted_successfully")),h.value=!1,b.value=null,k.value=null},onError:()=>{f.error(s("documents.delete_failed"))},onFinish:()=>{k.value=null}}))}return(n,d)=>(m(),ae(he,{breadcrumbs:X.value},{default:l(()=>[t(e(oe),{title:`${e(s)("common.edit")} - ${C.ticket.number}`},null,8,["title"]),r("div",Ue,[r("div",je,[t(e(x),{variant:"outline",size:"icon",onClick:j},{default:l(()=>[t(e(De),{class:"size-4"})]),_:1}),t(de,{title:`${e(s)("tickets.edit")} - ${C.ticket.number}`,description:e(s)("tickets.edit_description")},null,8,["title","description"])]),r("form",{onSubmit:le(I,["prevent"]),class:"space-y-6"},[t(e(O),null,{default:l(()=>[t(e(N),null,{default:l(()=>[t(e(B),{class:"flex items-center gap-2"},{default:l(()=>[t(e(K),{class:"size-5"}),c(" "+i(e(s)("tickets.ticket_info")),1)]),_:1}),t(e(A),null,{default:l(()=>[c(i(e(s)("tickets.edit_info_description")),1)]),_:1})]),_:1}),t(e(q),{class:"space-y-4"},{default:l(()=>[r("div",Ee,[r("div",Fe,[t(e(v),null,{default:l(()=>[c(i(e(s)("tickets.number")),1)]),_:1}),t(e(M),{"model-value":C.ticket.number,disabled:""},null,8,["model-value"]),r("p",Te,i(e(s)("tickets.number_readonly")),1)]),r("div",Oe,[t(e(v),null,{default:l(()=>[c(i(e(s)("tickets.date")),1)]),_:1}),t(e(M),{modelValue:e(o).date,"onUpdate:modelValue":d[0]||(d[0]=a=>e(o).date=a),type:"date",disabled:e(o).processing},null,8,["modelValue","disabled"]),e(o).errors.date?(m(),_("p",Ne,i(e(o).errors.date),1)):V("",!0)]),r("div",Be,[t(e(v),null,{default:l(()=>[c(i(e(s)("tickets.vendor")),1)]),_:1}),t(e(P),{modelValue:e(o).vendor_id,"onUpdate:modelValue":d[1]||(d[1]=a=>e(o).vendor_id=a),options:G.value,placeholder:e(s)("tickets.select_vendor"),disabled:e(o).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(o).errors.vendor_id?(m(),_("p",qe,i(e(o).errors.vendor_id),1)):V("",!0)]),r("div",Ae,[t(e(v),null,{default:l(()=>[c(i(e(s)("tickets.contract")),1)]),_:1}),t(e(P),{modelValue:e(o).contract_id,"onUpdate:modelValue":d[2]||(d[2]=a=>e(o).contract_id=a),options:H.value,placeholder:e(s)("tickets.select_contract"),disabled:e(o).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(o).errors.contract_id?(m(),_("p",Le,i(e(o).errors.contract_id),1)):V("",!0)]),r("div",Me,[t(e(v),null,{default:l(()=>[c(i(e(s)("tickets.notes")),1)]),_:1}),t(e(ge),{modelValue:e(o).notes,"onUpdate:modelValue":d[3]||(d[3]=a=>e(o).notes=a),placeholder:e(s)("tickets.notes_placeholder"),disabled:e(o).processing,rows:3},null,8,["modelValue","placeholder","disabled"]),e(o).errors.notes?(m(),_("p",Pe,i(e(o).errors.notes),1)):V("",!0)]),r("div",Ke,[t(e(ce),{id:"is_active",checked:e(o).is_active,"onUpdate:checked":d[4]||(d[4]=a=>e(o).is_active=a),disabled:e(o).processing},null,8,["checked","disabled"]),t(e(v),{for:"is_active",class:"font-normal"},{default:l(()=>[c(i(e(s)("common.active")),1)]),_:1})])])]),_:1})]),_:1}),t(e(O),null,{default:l(()=>[t(e(N),null,{default:l(()=>[r("div",Re,[r("div",null,[t(e(B),{class:"flex items-center gap-2"},{default:l(()=>[t(e(L),{class:"size-5"}),c(" "+i(e(s)("documents.title")),1)]),_:1}),t(e(A),null,{default:l(()=>[c(i(e(s)("documents.manage_description")),1)]),_:1})]),t(e(be),{variant:z.value.isComplete?"complete":"incomplete"},{default:l(()=>[c(i(z.value.count)+"/"+i(z.value.total),1)]),_:1},8,["variant"])])]),_:1}),t(e(q),null,{default:l(()=>[r("div",Xe,[(m(!0),_(ie,null,ne(e(w),a=>(m(),_("div",{key:a,class:"rounded-lg border p-4 space-y-3"},[r("div",Ye,[t(e(v),{class:"font-medium"},{default:l(()=>[c(i(e(s)(`documents.${a}`)),1)]),_:2},1024),t(e(re),{variant:p(a)?"default":"outline",class:"text-xs"},{default:l(()=>[c(i(p(a)?e(s)("status.complete"):e(s)("status.incomplete")),1)]),_:2},1032,["variant"])]),p(a)?(m(),_("div",Ge,[r("div",He,[r("div",Ie,[t(e(K),{class:"size-4 text-primary dark:text-primary/90 mt-0.5 shrink-0"}),r("span",Je,i(p(a).original_name),1)])]),r("div",Qe,[r("a",{href:e(Ve)(p(a).id).url,target:"_blank",class:"inline-flex items-center justify-center gap-1.5 flex-1 h-8 text-xs rounded-md border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 transition-colors px-3"},[t(e(Se),{class:"size-3.5"}),c(" "+i(e(s)("common.preview")),1)],8,We),t(e(x),{type:"button",variant:"destructive",size:"sm",class:"h-8 px-3",disabled:k.value===p(a).id,onClick:y=>Q(p(a))},{default:l(()=>[t(e(R),{class:"size-3.5"})]),_:1},8,["disabled","onClick"])])])):(m(),_("div",Ze,[t(e(ke),{"model-value":E.value[a],disabled:D.value===a,accept:".pdf,.jpg,.jpeg,.png","max-size":10240,"onUpdate:modelValue":y=>J(a,y)},null,8,["model-value","disabled","onUpdate:modelValue"]),D.value===a?(m(),_("div",et,[t(e(L),{class:"size-3.5"}),c(" "+i(e(s)("common.uploading")),1)])):V("",!0)]))]))),128))]),r("p",tt,i(e(s)("documents.fileTypes")),1)]),_:1})]),_:1}),r("div",st,[t(e(x),{type:"button",variant:"outline",onClick:j,disabled:e(o).processing},{default:l(()=>[c(i(e(s)("common.cancel")),1)]),_:1},8,["disabled"]),t(e(x),{type:"submit",disabled:e(o).processing},{default:l(()=>[t(e(ze),{class:"mr-2 size-4"}),c(" "+i(e(o).processing?e(s)("common.saving"):e(s)("common.save")),1)]),_:1},8,["disabled"])])],32)]),t(e(ue),{open:h.value,"onUpdate:open":d[6]||(d[6]=a=>h.value=a)},{default:l(()=>[t(e(me),{class:"sm:max-w-100"},{default:l(()=>[t(e(_e),null,{default:l(()=>[t(e(fe),null,{default:l(()=>[c(i(e(s)("common.confirm_delete")),1)]),_:1}),t(e(pe),null,{default:l(()=>[c(i(e(s)("documents.delete_confirmation",{name:b.value?.original_name})),1)]),_:1})]),_:1}),t(e(ve),null,{default:l(()=>[t(e(x),{variant:"outline",onClick:d[5]||(d[5]=a=>h.value=!1),disabled:k.value!==null},{default:l(()=>[c(i(e(s)("common.cancel")),1)]),_:1},8,["disabled"]),t(e(x),{variant:"destructive",onClick:W,disabled:k.value!==null},{default:l(()=>[t(e(R),{class:"mr-2 size-4"}),c(" "+i(e(s)("common.delete")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["breadcrumbs"]))}});export{Ft as default};
