import{d as Z,u as tt,a as et,w as st,c as h,b as n,e as o,f as t,h as ot,g as e,k as i,j as l,t as s,m as p,l as d,F,r as S,i as at,n as nt,s as $,p as j}from"./app-Az55F6M8.js";import{_ as ct,u as rt}from"./useActionConfirmation-BPstB5Uy.js";import{_ as it}from"./Heading.vue_vue_type_script_setup_true_lang-DzT-PsX3.js";import{_ as g}from"./index-BLT0FxeU.js";import{_ as z}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjG2TDFh.js";import{_ as y,a as b,b as k,c as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-DL5VZqU4.js";import{_ as N}from"./Input.vue_vue_type_script_setup_true_lang-9NyD3cCB.js";import{_ as T}from"./Label.vue_vue_type_script_setup_true_lang-BatJIAlb.js";import{_ as lt}from"./Select.vue_vue_type_script_setup_true_lang-C5fkymIU.js";import{_ as P}from"./StatusBadge.vue_vue_type_script_setup_true_lang-Ik7GkR5h.js";import{u as dt}from"./useDateFormat-BThD_v7S.js";import{u as mt,i as B,F as I,_ as ut,g as _t,j as pt,m as ft}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyTogOSr.js";import{A as vt}from"./arrow-left-DLIy3lRN.js";import{P as gt}from"./pencil-B0Lx0GLH.js";import{C as xt}from"./calendar-CPex_lsz.js";import{U as ht}from"./user-DuKwlFf0.js";import{S as M}from"./shield-check-CeOABV_k.js";import{P as yt}from"./plus-Rxuc06gk.js";import{T as bt}from"./trash-2-1tc8fb7c.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D7dEZzdR.js";import"./useForwardPropsEmits-DcGYh6Gw.js";import"./index-Dwg1ok0u.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CpvOfIA5.js";import"./useForwardExpose-Dz4tKeCh.js";import"./VisuallyHidden-C4XAoWlX.js";import"./VisuallyHiddenInput-dytHPRwB.js";import"./chevron-down-DzsoBm0Z.js";import"./createLucideIcon-iLJQO7DH.js";import"./check-CBSXup_1.js";import"./index-BDqSilVs.js";const kt={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ct={class:"flex items-center justify-between"},$t={class:"flex items-center gap-4"},zt={class:"flex items-center gap-2"},qt={class:"grid gap-6 lg:grid-cols-2"},Vt={class:"grid gap-4 sm:grid-cols-2"},Ft={class:"text-muted-foreground text-sm"},St={class:"font-medium"},Tt={class:"text-muted-foreground text-sm"},At={class:"font-medium"},Ut={class:"text-muted-foreground text-sm"},wt={class:"text-lg font-semibold"},Dt={class:"text-muted-foreground text-sm"},jt={key:0,class:"border-t pt-4"},Nt={class:"text-muted-foreground mb-2 text-sm"},Pt={key:0,class:"flex flex-wrap gap-2"},Bt={key:1,class:"text-muted-foreground text-sm"},It={class:"grid gap-4 sm:grid-cols-2"},Mt={class:"text-muted-foreground text-sm"},Rt={class:"font-medium"},Et={class:"text-muted-foreground text-sm"},Ot={class:"font-medium"},Lt={key:0,class:"sm:col-span-2"},Wt={class:"text-muted-foreground text-sm"},Gt={class:"font-medium"},Ht={key:1},Jt={class:"text-muted-foreground text-sm"},Kt={class:"font-medium"},Qt={key:2},Xt={class:"text-muted-foreground text-sm"},Yt={class:"font-medium"},Zt={key:0,class:"divide-y"},te=["onClick"],ee={class:"flex items-center gap-4"},se={class:"font-medium"},oe={class:"text-muted-foreground text-sm"},ae={class:"flex items-center gap-4"},ne={key:1,class:"text-muted-foreground py-8 text-center"},ce={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},re={class:"text-muted-foreground text-sm"},ie={class:"font-medium"},le={class:"text-muted-foreground text-sm"},de={class:"font-medium"},me={class:"text-muted-foreground text-sm"},ue={class:"font-medium"},_e={class:"text-muted-foreground text-sm"},pe={class:"font-medium"},fe={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},ve={class:"text-muted-foreground text-sm"},ge={class:"text-lg font-semibold"},xe={class:"text-muted-foreground text-sm"},he={class:"text-lg font-semibold text-green-600"},ye={class:"text-muted-foreground text-sm"},be={class:"text-lg font-semibold text-orange-600"},ke={class:"text-muted-foreground text-sm"},Ce={class:"space-y-1"},$e={class:"font-medium"},ze={key:0,class:"font-medium"},qe={key:0,class:"mt-4 border-t pt-4"},Ve={class:"text-muted-foreground mb-2 text-sm font-medium"},Fe={class:"space-y-2"},Se={key:0,class:"mt-1 text-xs text-muted-foreground"},Te={class:"lg:col-span-1"},Ae={class:"lg:col-span-4"},Ue={class:"lg:col-span-6"},we={key:0,class:"text-xs text-muted-foreground mt-1"},De={class:"flex items-end lg:col-span-1"},je={key:0,class:"text-sm text-destructive"},Ne={class:"flex justify-end"},_s=Z({__name:"Show",props:{contract:{},eligibleMasters:{}},setup(c){const v=c,{t:a}=tt(),{formatDateOnly:A,formatDateTime:U}=dt(),{canUpdate:R}=_t(),w=mt(),f=rt(),E=[{title:a("nav.contracts"),href:B().url},{title:v.contract.number,href:"#"}];function O(){$.get(B().url)}function L(){$.get(pt(v.contract.id).url)}function q(u){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(u)}function W(u){$.get(ft(u).url)}const G=j(()=>(v.eligibleMasters??[]).map(u=>({value:u.id,label:`${u.name} (${u.email})`}))),H=j(()=>G.value),m=et({approvers:[]});function J(){const u=(v.contract.approvers??[]).map((_,r)=>({user_id:_.user_id??null,sequence_no:_.sequence_no??r+1,remarks:_.remarks??"",is_master:_.is_master??!1}));m.approvers=u.length>0?u:[{user_id:null,sequence_no:1,remarks:"",is_master:!1}]}function D(){m.approvers=m.approvers.map((u,_)=>({...u,sequence_no:_+1}))}function K(){m.approvers.push({user_id:null,sequence_no:m.approvers.length+1,remarks:"",is_master:!1})}function Q(u){m.approvers[u]?.is_master||(m.approvers.splice(u,1),D())}function X(){D();const u=m.approvers.filter(_=>!_.is_master).map((_,r)=>({user_id:_.user_id,sequence_no:r+1,remarks:_.remarks}));$.post(`/contracts/${v.contract.id}/approvers`,{approvers:u},{preserveScroll:!0,onSuccess:()=>{w.success(a("contracts.approvers_updated_successfully")),$.reload({only:["contract"]})},onError:()=>{w.error(a("contracts.approvers_update_failed"))}})}function Y(){f.requestConfirmation({title:a("contracts.approvers"),description:"Update contract approvers and why they are required in the workflow.",confirmText:a("common.save"),details:[{label:a("contracts.contract_number"),value:v.contract.number},{label:a("contracts.approvers"),value:String(m.approvers.length)}]},X)}return st(()=>v.contract.approvers,()=>{J()},{immediate:!0}),(u,_)=>(i(),h(ut,{breadcrumbs:E},{default:n(()=>[o(t(ot),{title:`${t(a)("contracts.contract")} - ${c.contract.number}`},null,8,["title"]),e("div",kt,[e("div",Ct,[e("div",$t,[o(t(z),{variant:"outline",size:"icon",onClick:O},{default:n(()=>[o(t(vt),{class:"size-4"})]),_:1}),o(it,{title:c.contract.number,description:t(a)("contracts.contract_details")},null,8,["title","description"])]),e("div",zt,[o(t(P),{active:c.contract.is_active},null,8,["active"]),t(R)("contracts")?(i(),h(t(z),{key:0,onClick:L},{default:n(()=>[o(t(gt),{class:"mr-2 size-4"}),l(" "+s(t(a)("common.edit")),1)]),_:1})):p("",!0)])]),e("div",qt,[o(t(y),null,{default:n(()=>[o(t(b),null,{default:n(()=>[o(t(k),null,{default:n(()=>[l(s(t(a)("contracts.contract_info")),1)]),_:1})]),_:1}),o(t(C),{class:"space-y-4"},{default:n(()=>[e("div",Vt,[e("div",null,[e("p",Ft,s(t(a)("contracts.contract_number")),1),e("p",St,s(c.contract.number),1)]),e("div",null,[e("p",Tt,s(t(a)("contracts.date")),1),e("p",At,s(t(A)(c.contract.date)),1)]),e("div",null,[e("p",Ut,s(t(a)("contracts.amount")),1),e("p",wt,s(q(c.contract.amount)),1)]),e("div",null,[e("p",Dt,s(t(a)("contracts.cooperation_type")),1),o(t(g),{variant:c.contract.cooperation_type==="progress"?"default":"secondary"},{default:n(()=>[l(s(t(a)(`contracts.cooperation_types.${c.contract.cooperation_type}`)),1)]),_:1},8,["variant"])])]),c.contract.cooperation_type==="progress"?(i(),d("div",jt,[e("p",Nt,s(t(a)("contracts.term_percentages")),1),c.contract.term_percentages?.length?(i(),d("div",Pt,[(i(!0),d(F,null,S(c.contract.term_percentages,(r,x)=>(i(),h(t(g),{key:x,variant:"outline"},{default:n(()=>[l(s(t(a)("contracts.term_n",{n:x+1}))+": "+s(r)+"% ",1)]),_:2},1024))),128))])):(i(),d("p",Bt,"-"))])):p("",!0)]),_:1})]),_:1}),c.contract.vendor?(i(),h(t(y),{key:0},{default:n(()=>[o(t(b),null,{default:n(()=>[o(t(k),null,{default:n(()=>[l(s(t(a)("contracts.vendor_info")),1)]),_:1})]),_:1}),o(t(C),{class:"space-y-4"},{default:n(()=>[e("div",It,[e("div",null,[e("p",Mt,s(t(a)("vendors.code")),1),e("p",Rt,s(c.contract.vendor.code),1)]),e("div",null,[e("p",Et,s(t(a)("vendors.name")),1),e("p",Ot,s(c.contract.vendor.name),1)]),c.contract.vendor.address?(i(),d("div",Lt,[e("p",Wt,s(t(a)("vendors.address")),1),e("p",Gt,s(c.contract.vendor.address),1)])):p("",!0),c.contract.vendor.contact_person?(i(),d("div",Ht,[e("p",Jt,s(t(a)("vendors.contact_person")),1),e("p",Kt,s(c.contract.vendor.contact_person),1)])):p("",!0),c.contract.vendor.tax_id?(i(),d("div",Qt,[e("p",Xt,s(t(a)("vendors.tax_id")),1),e("p",Yt,s(c.contract.vendor.tax_id),1)])):p("",!0)])]),_:1})]),_:1})):p("",!0)]),o(t(y),null,{default:n(()=>[o(t(b),null,{default:n(()=>[o(t(k),{class:"flex items-center gap-2"},{default:n(()=>[o(t(I),{class:"size-5"}),l(" "+s(t(a)("contracts.related_tickets"))+" ",1),o(t(g),{variant:"secondary"},{default:n(()=>[l(s(c.contract.tickets?.length||0),1)]),_:1})]),_:1})]),_:1}),o(t(C),null,{default:n(()=>[c.contract.tickets?.length?(i(),d("div",Zt,[(i(!0),d(F,null,S(c.contract.tickets,r=>(i(),d("div",{key:r.id,class:"flex cursor-pointer items-center justify-between py-4 transition-colors hover:bg-muted/50",onClick:x=>W(r.id)},[e("div",ee,[e("div",null,[e("p",se,s(r.number),1),e("p",oe,[o(t(xt),{class:"mr-1 inline size-3"}),l(" "+s(t(A)(r.date)),1)])])]),e("div",ae,[r.documents?.length?(i(),h(t(g),{key:0,variant:"outline"},{default:n(()=>[l(s(r.documents.length)+" "+s(t(a)("documents.documents")),1)]),_:2},1024)):p("",!0),o(t(P),{active:r.status==="complete","active-text":t(a)("tickets.status_types.complete"),"inactive-text":t(a)("tickets.status_types.incomplete")},null,8,["active","active-text","inactive-text"])])],8,te))),128))])):(i(),d("div",ne,[o(t(I),{class:"mx-auto mb-2 size-8 opacity-50"}),e("p",null,s(t(a)("contracts.no_tickets")),1)]))]),_:1})]),_:1}),o(t(y),null,{default:n(()=>[o(t(b),null,{default:n(()=>[o(t(k),{class:"flex items-center gap-2"},{default:n(()=>[o(t(ht),{class:"size-5"}),l(" "+s(t(a)("common.audit_info")),1)]),_:1})]),_:1}),o(t(C),null,{default:n(()=>[e("div",ce,[e("div",null,[e("p",re,s(t(a)("common.created_by")),1),e("p",ie,s(c.contract.created_by?.name||"-"),1)]),e("div",null,[e("p",le,s(t(a)("common.created_at")),1),e("p",de,s(t(U)(c.contract.created_at)),1)]),e("div",null,[e("p",me,s(t(a)("common.updated_by")),1),e("p",ue,s(c.contract.updated_by?.name||"-"),1)]),e("div",null,[e("p",_e,s(t(a)("common.updated_at")),1),e("p",pe,s(t(U)(c.contract.updated_at)),1)])])]),_:1})]),_:1}),o(t(y),null,{default:n(()=>[o(t(b),null,{default:n(()=>[o(t(k),{class:"flex items-center gap-2"},{default:n(()=>[o(t(M),{class:"size-5"}),l(" "+s(t(a)("contracts.payment_summary")),1)]),_:1})]),_:1}),o(t(C),null,{default:n(()=>[e("div",fe,[e("div",null,[e("p",ve,s(t(a)("contracts.amount")),1),e("p",ge,s(q(c.contract.amount)),1)]),e("div",null,[e("p",xe,s(t(a)("contracts.total_paid")),1),e("p",he,s(q(c.contract.payment_total_paid??0)),1)]),e("div",null,[e("p",ye,s(t(a)("contracts.outstanding_balance")),1),e("p",be,s(q(c.contract.payment_balance??c.contract.amount)),1)]),e("div",null,[e("p",ke,s(t(a)("contracts.contract_master")),1),e("div",Ce,[e("p",$e,[l(s(c.contract.created_by?.name||"-")+" ",1),o(t(g),{variant:"outline",class:"ml-1 text-xs"},{default:n(()=>[l(s(t(a)("contracts.creator")),1)]),_:1})]),c.contract.assigned_master?(i(),d("p",ze,[l(s(c.contract.assigned_master?.name)+" ",1),o(t(g),{variant:"outline",class:"ml-1 text-xs"},{default:n(()=>[l(s(t(a)("contracts.assigned")),1)]),_:1})])):p("",!0)])])]),c.contract.approvers?.length?(i(),d("div",qe,[e("p",Ve,s(t(a)("contracts.approvers")),1),e("div",Fe,[(i(!0),d(F,null,S(c.contract.approvers,r=>(i(),d("div",{key:r.id,class:"rounded-md border p-2"},[o(t(g),{variant:"secondary"},{default:n(()=>[l(" #"+s(r.sequence_no)+" "+s(r.user?.name),1)]),_:2},1024),r.remarks?(i(),d("p",Se,s(r.remarks),1)):p("",!0)]))),128))])])):p("",!0)]),_:1})]),_:1}),o(t(y),null,{default:n(()=>[o(t(b),null,{default:n(()=>[o(t(k),{class:"flex items-center justify-between gap-2"},{default:n(()=>[e("span",null,s(t(a)("contracts.approvers")),1),o(t(z),{type:"button",variant:"outline",size:"sm",onClick:K,disabled:t(m).processing},{default:n(()=>[o(t(yt),{class:"mr-1 size-4"}),l(" "+s(t(a)("common.create")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),o(t(C),null,{default:n(()=>[e("form",{class:"space-y-3",onSubmit:at(Y,["prevent"])},[(i(!0),d(F,null,S(t(m).approvers,(r,x)=>(i(),d("div",{key:`approver-row-${x}`,class:nt(["grid gap-3 rounded-md border p-3 lg:grid-cols-12",r.is_master?"bg-muted/40":""])},[e("div",Te,[o(t(T),null,{default:n(()=>[..._[1]||(_[1]=[l("Seq",-1)])]),_:1}),o(t(N),{"model-value":r.sequence_no,disabled:""},null,8,["model-value"])]),e("div",Ae,[o(t(T),null,{default:n(()=>[l(s(t(a)("nav.users")),1)]),_:1}),o(t(lt),{modelValue:r.user_id,"onUpdate:modelValue":V=>r.user_id=V,options:H.value,placeholder:t(a)("common.select"),disabled:t(m).processing||r.is_master,clearable:!r.is_master},null,8,["modelValue","onUpdate:modelValue","options","placeholder","disabled","clearable"])]),e("div",Ue,[o(t(T),null,{default:n(()=>[..._[2]||(_[2]=[l("Remarks",-1)])]),_:1}),o(t(N),{modelValue:r.remarks,"onUpdate:modelValue":V=>r.remarks=V,placeholder:"Why this approver is required",disabled:t(m).processing||r.is_master},null,8,["modelValue","onUpdate:modelValue","disabled"]),r.is_master?(i(),d("p",we,[o(t(M),{class:"inline size-3 mr-0.5"}),l(" "+s(t(a)("contracts.contract_master")),1)])):p("",!0)]),e("div",De,[r.is_master?p("",!0):(i(),h(t(z),{key:0,type:"button",variant:"ghost",size:"icon",disabled:t(m).processing,onClick:V=>Q(x)},{default:n(()=>[o(t(bt),{class:"size-4"})]),_:1},8,["disabled","onClick"]))])],2))),128)),t(m).errors.approvers?(i(),d("p",je,s(t(m).errors.approvers),1)):p("",!0),e("div",Ne,[o(t(z),{type:"submit",disabled:t(m).processing},{default:n(()=>[l(s(t(m).processing?t(a)("common.saving"):t(a)("common.save")),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})]),o(ct,{open:t(f).open.value,"onUpdate:open":_[0]||(_[0]=r=>t(f).open.value=r),title:t(f).title.value,description:t(f).description.value,"confirm-text":t(f).confirmText.value,"cancel-text":t(f).cancelText.value,destructive:t(f).destructive.value,details:t(f).details.value,onConfirm:t(f).confirm,onCancel:t(f).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"])]),_:1}))}});export{_s as default};
