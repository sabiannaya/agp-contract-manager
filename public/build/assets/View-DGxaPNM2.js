import{d as K,u as Y,m as p,g as t,e as l,b as r,j as m,t as o,f as e,F as I,p as q,n as k,s as W,k as x,c as B,i as c,B as Z,w as ee,r as F,h as te,y as L,C as se,D as oe,q as S}from"./app-D6ZExuG4.js";import{c as X,_ as V}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BAMJN8k7.js";import{D as y,_ as ne,U as ae}from"./models-CJdPgyWg.js";import{_ as A}from"./StatusBadge.vue_vue_type_script_setup_true_lang-DTLVhpcY.js";import{_ as z}from"./Label.vue_vue_type_script_setup_true_lang-B7C0xePR.js";import{_ as le}from"./Heading.vue_vue_type_script_setup_true_lang-C_Qaqaft.js";import{_ as ie,a as de,b as re,c as ue,d as ce}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CgDzptfY.js";import{_ as me}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CmMndOaZ.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-B9Upw0KD.js";import{_ as fe}from"./Pagination.vue_vue_type_script_setup_true_lang-DIGKOJqX.js";import{u as _e}from"./useDateFormat-BThD_v7S.js";import{E as P,X as pe,G as ve,F as ge,d as he,u as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-DhQ7Babn.js";import{s as xe,d as ke}from"./index-PwX051BP.js";import{c as ye}from"./createLucideIcon-BXqO2veZ.js";import{C as we}from"./chevron-down-DKASTZ1i.js";import{E as $e}from"./eye-Cfy1nj4J.js";import{u as Ce}from"./index-Dnaiof97.js";import"./useForwardExpose-6n7ayWvE.js";import"./useForwardPropsEmits-BgLpAiDO.js";import"./VisuallyHidden-D-NgPM13.js";import"./index-BDqSilVs.js";const De=ye("FilterIcon",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),Fe={class:"flex items-center justify-between"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve={class:"text-sm"},ze=["href"],Ue={class:"text-xs text-muted-foreground"},Ee=K({__name:"DocumentUploadGrid",props:{documents:{},files:{},disabled:{type:Boolean},readonly:{type:Boolean},class:{}},emits:["update:files","remove"],setup(f,{emit:w}){const n=f,N=w,{t:h}=Y(),U=W(()=>{const _=y.filter(g=>{const d=n.documents.some(T=>T.type===g),C=n.files[g];return d||C}).length;return{count:_,total:y.length,isComplete:_>=y.length}});function i(_){return n.documents.find(g=>g.type===_)}function R(_,g){const d={...n.files,[_]:g};N("update:files",d)}function $(_){R(_,null),N("remove",_)}return(_,g)=>(c(),p("div",{class:k(e(X)("space-y-4",n.class))},[t("div",Fe,[l(e(z),{class:"text-base font-semibold"},{default:r(()=>[m(o(e(h)("documents.title")),1)]),_:1}),l(e(A),{variant:U.value.isComplete?"complete":"incomplete"},{default:r(()=>[m(o(U.value.count)+"/"+o(U.value.total)+" "+o(e(h)("tickets.completeness")),1)]),_:1},8,["variant"])]),t("div",Se,[(c(!0),p(I,null,q(e(y),d=>(c(),p("div",{key:d,class:"space-y-2"},[l(e(z),null,{default:r(()=>[m(o(e(h)(`documents.${d}`)),1)]),_:2},1024),f.readonly?(c(),p("div",{key:0,class:k(e(X)("flex items-center justify-between gap-2 rounded-md border p-3","border-input bg-muted/30"))},[t("span",Ve,o(i(d)?.original_name??e(h)("documents.noFile")),1),i(d)?(c(),p("a",{key:0,href:`/documents/${i(d)?.id}/preview`,target:"_blank",class:"text-sm text-primary hover:underline"},o(e(h)("common.preview")),9,ze)):x("",!0)],2)):(c(),B(e(ne),{key:1,"model-value":f.files[d],"existing-file":i(d)?{name:i(d).original_name,url:`/documents/${i(d).id}/preview`}:null,disabled:f.disabled,accept:".pdf,.jpg,.jpeg,.png","max-size":10240,"onUpdate:modelValue":C=>R(d,C),onRemove:C=>$(d)},null,8,["model-value","existing-file","disabled","onUpdate:modelValue","onRemove"]))]))),128))]),t("p",Ue,o(e(h)("documents.fileTypes")),1)],2))}}),je={class:"space-y-6"},Oe={class:"flex items-center gap-2"},Be={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 p-4 border rounded-lg bg-muted/20"},Ne={class:"space-y-2"},Re={class:"space-y-2"},Te={class:"space-y-2"},Ie={class:"space-y-2"},Me={value:""},Pe={value:"complete"},qe={value:"incomplete"},Ge={class:"rounded-md border"},Le={class:"w-full caption-bottom text-sm"},Xe={class:"[&_tr]:border-b bg-muted/50"},Ke={class:"border-b"},Ye={class:"h-10 px-4 text-left font-medium text-muted-foreground"},Ae={class:"h-10 px-4 text-left font-medium text-muted-foreground"},He={class:"h-10 px-4 text-left font-medium text-muted-foreground"},Je={class:"h-10 px-4 text-left font-medium text-muted-foreground"},Qe={class:"h-10 px-4 text-left font-medium text-muted-foreground"},We={class:"h-10 px-4 text-left font-medium text-muted-foreground"},Ze={key:0},et={colspan:"8",class:"h-24 text-center text-muted-foreground"},tt={class:"border-b hover:bg-muted/50 transition-colors"},st={class:"px-2"},ot={class:"px-4 py-3 font-medium"},nt={class:"px-4 py-3"},at={class:"px-4 py-3"},lt={class:"px-4 py-3"},it={class:"px-4 py-3"},dt={class:"px-4 py-3"},rt={class:"px-4 py-3"},ut={key:0},ct={colspan:"8",class:"p-4 bg-muted/20"},mt={class:"grid grid-cols-5 gap-4"},ft={class:"flex-1 min-w-0"},_t={class:"text-xs font-medium truncate"},pt={class:"text-xs text-muted-foreground truncate"},vt=["href"],Tt=K({__name:"View",props:{tickets:{},filters:{}},setup(f){const w=f,{t:n}=Y(),{formatDateOnly:N}=_e(),{canUpdate:h}=be(),U=[{title:n("nav.view_tickets"),href:P().url}],i=Z({vendor_name:w.filters.vendor_name??"",ticket_number:w.filters.ticket_number??"",date:w.filters.date??"",status:w.filters.status??""}),R=Ce(()=>{S.get(P().url,{vendor_name:i.vendor_name||void 0,ticket_number:i.ticket_number||void 0,date:i.date||void 0,status:i.status||void 0,page:1},{preserveState:!0,preserveScroll:!0})},300);ee(i,R);const $=F(!1);function _(){i.vendor_name="",i.ticket_number="",i.date="",i.status="",S.get(P().url,{},{preserveState:!0,preserveScroll:!0})}function g(u){S.get(u,{},{preserveState:!0,preserveScroll:!0})}const d=F(new Set);function C(u){d.value.has(u)?d.value.delete(u):d.value.add(u)}function T(u){return{count:u.documents?.length??u.documents_count??0,total:5}}const E=F(!1),b=F(null),j=F(Object.fromEntries(y.map(u=>[u,null]))),D=F(!1);function H(u){b.value=u,j.value=Object.fromEntries(y.map(a=>[a,null])),E.value=!0}async function J(){if(b.value){D.value=!0;try{for(const[u,a]of Object.entries(j.value))if(a){const s=new FormData;s.append("file",a),s.append("ticket_id",String(b.value.id)),s.append("type",u),await fetch(xe().url,{method:"POST",body:s,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content??""}})}S.reload({only:["tickets"]}),E.value=!1}finally{D.value=!1}}}function Q(u){if(!b.value)return;const a=b.value.documents?.find(s=>s.type===u);a&&S.delete(ke(a.id).url,{preserveScroll:!0,onSuccess:()=>{S.reload({only:["tickets"]})}})}function G(u,a){return u.documents?.find(v=>v.type===a)?"exists":"missing"}return(u,a)=>(c(),B(he,{breadcrumbs:U},{default:r(()=>[l(e(te),{title:e(n)("nav.view_tickets")},null,8,["title"]),t("div",je,[l(le,{title:e(n)("nav.view_tickets"),description:e(n)("tickets.view_description")},null,8,["title","description"]),t("div",Oe,[l(e(V),{variant:"outline",size:"sm",onClick:a[0]||(a[0]=s=>$.value=!$.value)},{default:r(()=>[l(e(De),{class:"mr-2 size-4"}),m(" "+o(e(n)("common.filters"))+" ",1),l(e(we),{class:k(["ml-2 size-4 transition-transform",$.value&&"rotate-180"])},null,8,["class"])]),_:1}),Object.values(i).some(Boolean)?(c(),B(e(V),{key:0,variant:"ghost",size:"sm",onClick:_},{default:r(()=>[l(e(pe),{class:"mr-2 size-4"}),m(" "+o(e(n)("common.clear_filters")),1)]),_:1})):x("",!0)]),L(t("div",Be,[t("div",Ne,[l(e(z),null,{default:r(()=>[m(o(e(n)("tickets.vendor")),1)]),_:1}),l(e(M),{modelValue:i.vendor_name,"onUpdate:modelValue":a[1]||(a[1]=s=>i.vendor_name=s),placeholder:e(n)("tickets.filter_vendor")},null,8,["modelValue","placeholder"])]),t("div",Re,[l(e(z),null,{default:r(()=>[m(o(e(n)("tickets.number")),1)]),_:1}),l(e(M),{modelValue:i.ticket_number,"onUpdate:modelValue":a[2]||(a[2]=s=>i.ticket_number=s),placeholder:e(n)("tickets.filter_number")},null,8,["modelValue","placeholder"])]),t("div",Te,[l(e(z),null,{default:r(()=>[m(o(e(n)("tickets.date")),1)]),_:1}),l(e(M),{modelValue:i.date,"onUpdate:modelValue":a[3]||(a[3]=s=>i.date=s),type:"date"},null,8,["modelValue"])]),t("div",Ie,[l(e(z),null,{default:r(()=>[m(o(e(n)("common.status")),1)]),_:1}),L(t("select",{"onUpdate:modelValue":a[4]||(a[4]=s=>i.status=s),class:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-xs focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"},[t("option",Me,o(e(n)("common.all")),1),t("option",Pe,o(e(n)("tickets.status.complete")),1),t("option",qe,o(e(n)("tickets.status.incomplete")),1)],512),[[se,i.status]])])],512),[[oe,$.value]]),t("div",Ge,[t("table",Le,[t("thead",Xe,[t("tr",Ke,[a[8]||(a[8]=t("th",{class:"h-10 w-[40px] px-2"},null,-1)),t("th",Ye,o(e(n)("tickets.number")),1),t("th",Ae,o(e(n)("tickets.date")),1),t("th",He,o(e(n)("tickets.vendor")),1),t("th",Je,o(e(n)("tickets.contract")),1),t("th",Qe,o(e(n)("tickets.completeness")),1),t("th",We,o(e(n)("common.status")),1),a[9]||(a[9]=t("th",{class:"h-10 w-[100px] px-4"},null,-1))])]),t("tbody",null,[f.tickets.data.length===0?(c(),p("tr",Ze,[t("td",et,o(e(n)("common.no_data")),1)])):x("",!0),(c(!0),p(I,null,q(f.tickets.data,s=>(c(),p(I,{key:s.id},[t("tr",tt,[t("td",st,[l(e(V),{variant:"ghost",size:"icon",class:"size-8",onClick:v=>C(s.id)},{default:r(()=>[l(e(ve),{class:k(["size-4 transition-transform",d.value.has(s.id)&&"rotate-90"])},null,8,["class"])]),_:2},1032,["onClick"])]),t("td",ot,o(s.number),1),t("td",nt,o(e(N)(s.date)),1),t("td",at,o(s.vendor?.name),1),t("td",lt,o(s.contract?.number),1),t("td",it,[t("span",{class:k(["text-sm font-medium",T(s).count===5?"text-green-600":"text-amber-600"])},o(T(s).count)+"/5 ",3)]),t("td",dt,[l(e(A),{status:s.status},null,8,["status"])]),t("td",rt,[e(h)("tickets")?(c(),B(e(V),{key:0,variant:"outline",size:"sm",onClick:v=>H(s)},{default:r(()=>[l(e(ae),{class:"mr-2 size-4"}),m(" "+o(e(n)("documents.manage")),1)]),_:1},8,["onClick"])):x("",!0)])]),d.value.has(s.id)?(c(),p("tr",ut,[t("td",ct,[t("div",mt,[(c(!0),p(I,null,q(e(y),v=>(c(),p("div",{key:v,class:k(["flex items-center gap-2 p-3 rounded-md border",G(s,v)==="exists"?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950":"border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950"])},[l(e(ge),{class:k(["size-5",G(s,v)==="exists"?"text-green-600":"text-amber-600"])},null,8,["class"]),t("div",ft,[t("p",_t,o(e(n)(`documents.${v}`)),1),t("p",pt,o(s.documents?.find(O=>O.type===v)?.original_name??e(n)("documents.noFile")),1)]),s.documents?.find(O=>O.type===v)?(c(),p("a",{key:0,href:`/documents/${s.documents.find(O=>O.type===v)?.id}/preview`,target:"_blank",class:"p-1 hover:bg-background rounded"},[l(e($e),{class:"size-4 text-muted-foreground hover:text-foreground"})],8,vt)):x("",!0)],2))),128))])])])):x("",!0)],64))),128))])])]),l(e(fe),{links:f.tickets.links,from:f.tickets.from,to:f.tickets.to,total:f.tickets.total,onNavigate:g},null,8,["links","from","to","total"])]),l(e(ie),{open:E.value,"onUpdate:open":a[7]||(a[7]=s=>E.value=s)},{default:r(()=>[l(e(de),{class:"sm:max-w-[700px]"},{default:r(()=>[l(e(re),null,{default:r(()=>[l(e(ue),null,{default:r(()=>[m(o(e(n)("documents.manage"))+" - "+o(b.value?.number),1)]),_:1}),l(e(ce),null,{default:r(()=>[m(o(e(n)("documents.manage_description")),1)]),_:1})]),_:1}),b.value?(c(),B(Ee,{key:0,documents:b.value.documents??[],files:j.value,"onUpdate:files":a[5]||(a[5]=s=>j.value=s),disabled:D.value,onRemove:Q},null,8,["documents","files","disabled"])):x("",!0),l(e(me),null,{default:r(()=>[l(e(V),{variant:"outline",onClick:a[6]||(a[6]=s=>E.value=!1),disabled:D.value},{default:r(()=>[m(o(e(n)("common.cancel")),1)]),_:1},8,["disabled"]),l(e(V),{onClick:J,disabled:D.value||!Object.values(j.value).some(Boolean)},{default:r(()=>[m(o(D.value?e(n)("common.uploading"):e(n)("common.upload")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Tt as default};
