import{d as de,u as ue,o as me,r as x,w as U,a as _e,c as w,b as l,e as s,f as e,h as pe,g as c,i as u,j as d,t as i,k as m,l as fe,m as _,n as ve,F as ge,p as be,q as $,s as C}from"./app-CuI7LdXL.js";import{_ as ye}from"./Heading.vue_vue_type_script_setup_true_lang-BHjUqA3V.js";import{_ as xe}from"./index-D_NX9Eof.js";import{_ as h}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BUBYiqAX.js";import{S as ke,_ as he}from"./DataTable.vue_vue_type_script_setup_true_lang-BKoDKxgg.js";import{_ as I,a as P,b as T,c as j,d as B}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C-SfElTY.js";import{_ as q}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Bw_2LaqB.js";import{i as F,_ as Ve,a as $e,b as Ce,c as M,d as Se,u as we,l as De,s as Ue,e as Fe,f as Me,g as ze}from"./AppLayout.vue_vue_type_script_setup_true_lang-CwkbJi7E.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-DLaguvqt.js";import{_ as Ee}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-BsyeBIW3.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-BVYJy_EQ.js";import{E as Ne,_ as Oe}from"./Pagination.vue_vue_type_script_setup_true_lang-8C8Mf2Mc.js";import{_ as z}from"./Select.vue_vue_type_script_setup_true_lang-QPZrs6lE.js";import{_ as Ie}from"./StatusBadge.vue_vue_type_script_setup_true_lang-MmS8OP8w.js";import{u as Pe}from"./useDateFormat-BThD_v7S.js";import{P as Te}from"./plus-gEXAE-os.js";import{E as je}from"./eye-CwGG716I.js";import{P as Be}from"./pencil-CZinZyQI.js";import{T as qe}from"./trash-2-C9QLNDK2.js";import{u as Le}from"./index-BRm__Hk1.js";import"./createLucideIcon-CX-op3lg.js";import"./Spinner.vue_vue_type_script_setup_true_lang-Br3sTUwP.js";import"./chevron-down-DGBHzGpy.js";import"./useForwardPropsEmits-CaKxx7wQ.js";import"./VisuallyHidden-DxCKGmrj.js";import"./useForwardExpose-D4WvoR71.js";import"./index-BDqSilVs.js";import"./VisuallyHiddenInput-8nto7-pU.js";import"./check-CLJgvc3L.js";const Re={class:"flex flex-col gap-6 p-6"},Ae={class:"flex items-center justify-between"},Ge={class:"flex items-center gap-4"},He={class:"relative flex-1 max-w-sm"},Je={class:"overflow-auto"},Ke={class:"sr-only"},Qe={class:"shrink-0 border-t bg-background pt-4"},We={class:"grid gap-4"},Xe={class:"grid grid-cols-2 gap-4"},Ye={class:"space-y-2"},Ze={key:0,class:"text-sm text-destructive"},et={class:"space-y-2"},tt={key:0,class:"text-sm text-destructive"},st={class:"space-y-2"},at={key:0,class:"text-sm text-destructive"},ot={class:"grid grid-cols-2 gap-4"},lt={class:"space-y-2"},rt={key:0,class:"text-sm text-destructive"},nt={class:"space-y-2"},it={key:0,class:"text-sm text-destructive"},ct={class:"space-y-2"},dt={class:"text-xs text-muted-foreground"},ut={key:0,class:"text-sm text-destructive"},mt={key:0,class:"space-y-4 border rounded-lg p-4"},_t={class:"space-y-2"},pt={key:0,class:"text-sm text-destructive"},ft={key:0,class:"space-y-2"},vt={class:"flex items-center justify-between"},gt={class:"grid grid-cols-4 gap-2"},bt={class:"relative"},yt={key:0,class:"text-sm text-destructive"},Qt=de({__name:"Index",props:{contracts:{},filters:{},eligibleMasters:{}},setup(k){const g=k,{t:o}=ue(),{formatDateOnly:L}=Pe(),{canCreate:R,canUpdate:A,canDelete:G}=we(),H=[{title:o("nav.contracts"),href:F().url}],E=x([]),N=x(!1);async function J(){N.value=!0;try{const a=await fetch(De().url);E.value=await a.json()}finally{N.value=!1}}me(J);const D=x(g.filters.search??""),K=Le(a=>{$.get(F().url,{...g.filters,search:a||void 0,page:1},{preserveState:!0,preserveScroll:!0})},300);U(D,a=>K(a));function Q(a,n){$.get(F().url,{...g.filters,sort:a,direction:n},{preserveState:!0,preserveScroll:!0})}function W(a){$.get(a,{},{preserveState:!0,preserveScroll:!0})}const X=[{key:"number",label:o("contracts.number"),sortable:!0},{key:"date",label:o("contracts.date"),sortable:!0},{key:"vendor.name",label:o("contracts.vendor")},{key:"cooperation_type",label:o("contracts.cooperation_type"),sortable:!0},{key:"amount",label:o("contracts.amount"),sortable:!0,class:"text-right"},{key:"is_active",label:o("common.status"),sortable:!0},{key:"actions",label:"",class:"w-[70px]"}];function Y(a){return a==null?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}const Z=C(()=>E.value.map(a=>({value:a.id,label:`${a.code} - ${a.name}`}))),ee=C(()=>[{value:"routine",label:o("contracts.types.routine")},{value:"progress",label:o("contracts.types.progress")}]),te=C(()=>(g.eligibleMasters??[]).map(a=>({value:a.id,label:`${a.name} (${a.email})`}))),b=x(!1),V=x(!1),p=x(null),t=_e({number:"",date:new Date().toISOString().split("T")[0],vendor_id:null,amount:0,cooperation_type:"routine",term_count:null,term_percentages:[],is_active:!0,assigned_master_user_id:null}),se=C(()=>p.value?o("contracts.edit"):o("contracts.create")),f=x([]);U(()=>t.term_count,a=>{if(a&&a>0){const n=[...f.value];if(a>n.length)for(let r=n.length;r<a;r++)n.push(0);else n.splice(a);f.value=n,t.term_percentages=n}else f.value=[],t.term_percentages=[]}),U(f,a=>{t.term_percentages=[...a]},{deep:!0});const O=C(()=>f.value.reduce((a,n)=>a+(n||0),0));function ae(){p.value=null,t.reset(),t.clearErrors(),f.value=[],t.assigned_master_user_id=null,b.value=!0}function oe(a){$.get(Ue(a.id).url)}function le(a){p.value=a,t.number=a.number,t.date=a.date,t.vendor_id=a.vendor_id,t.amount=a.amount,t.cooperation_type=a.cooperation_type,t.term_count=a.term_count,t.term_percentages=a.term_percentages??[],f.value=a.term_percentages??[],t.is_active=a.is_active,t.assigned_master_user_id=a.assigned_master_user_id??null,t.clearErrors(),b.value=!0}function re(a){p.value=a,V.value=!0}function ne(){p.value?t.put(Fe(p.value.id).url,{onSuccess:()=>{b.value=!1}}):t.post(Me().url,{onSuccess:()=>{b.value=!1}})}function ie(){p.value&&$.delete(ze(p.value.id).url,{onSuccess:()=>{V.value=!1,p.value=null}})}return(a,n)=>(u(),w(Se,{breadcrumbs:H},{default:l(()=>[s(e(pe),{title:e(o)("nav.contracts")},null,8,["title"]),c("div",Re,[c("div",Ae,[s(ye,{title:e(o)("nav.contracts"),description:e(o)("contracts.description")},null,8,["title","description"]),e(R)("contracts")?(u(),w(e(h),{key:0,onClick:ae},{default:l(()=>[s(e(Te),{class:"mr-2 size-4"}),d(" "+i(e(o)("contracts.create")),1)]),_:1})):m("",!0)]),c("div",Ge,[c("div",He,[s(e(ke),{class:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),s(e(S),{modelValue:D.value,"onUpdate:modelValue":n[0]||(n[0]=r=>D.value=r),placeholder:e(o)("common.search"),class:"pl-9"},null,8,["modelValue","placeholder"])])]),c("div",Je,[s(e(he),{columns:X,data:k.contracts.data,"sort-field":typeof g.filters.sort=="string"?g.filters.sort:void 0,"sort-direction":g.filters.direction,"empty-text":e(o)("common.no_data"),hoverable:"",onSort:Q},{"cell-cooperation_type":l(({value:r})=>[s(e(xe),{variant:r==="progress"?"default":"secondary"},{default:l(()=>[d(i(e(o)(`contracts.types.${r}`)),1)]),_:2},1032,["variant"])]),"cell-date":l(({value:r})=>[d(i(e(L)(r)),1)]),"cell-amount":l(({value:r})=>[d(i(Y(r)),1)]),"cell-is_active":l(({value:r})=>[s(e(Ie),{status:r?"active":"inactive"},null,8,["status"])]),"cell-actions":l(({row:r})=>[s(e(Ve),null,{default:l(()=>[s(e($e),{"as-child":""},{default:l(()=>[s(e(h),{variant:"ghost",size:"icon",class:"size-8"},{default:l(()=>[s(e(Ne),{class:"size-4"}),c("span",Ke,i(e(o)("common.actions")),1)]),_:1})]),_:1}),s(e(Ce),{align:"end"},{default:l(()=>[s(e(M),{onClick:y=>oe(r)},{default:l(()=>[s(e(je),{class:"mr-2 size-4"}),d(" "+i(e(o)("common.view")),1)]),_:1},8,["onClick"]),e(A)("contracts")?(u(),w(e(M),{key:0,onClick:y=>le(r)},{default:l(()=>[s(e(Be),{class:"mr-2 size-4"}),d(" "+i(e(o)("common.edit")),1)]),_:1},8,["onClick"])):m("",!0),e(G)("contracts")?(u(),w(e(M),{key:1,class:"text-destructive focus:text-destructive",onClick:y=>re(r)},{default:l(()=>[s(e(qe),{class:"mr-2 size-4"}),d(" "+i(e(o)("common.delete")),1)]),_:1},8,["onClick"])):m("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","sort-field","sort-direction","empty-text"])]),c("div",Qe,[s(e(Oe),{links:k.contracts.links,from:k.contracts.from,to:k.contracts.to,total:k.contracts.total,onNavigate:W},null,8,["links","from","to","total"])])]),s(e(I),{open:b.value,"onUpdate:open":n[9]||(n[9]=r=>b.value=r)},{default:l(()=>[s(e(P),{class:"sm:max-w-[600px]"},{default:l(()=>[s(e(T),null,{default:l(()=>[s(e(j),null,{default:l(()=>[d(i(se.value),1)]),_:1}),s(e(B),null,{default:l(()=>[d(i(p.value?e(o)("contracts.edit_description"):e(o)("contracts.create_description")),1)]),_:1})]),_:1}),c("form",{onSubmit:fe(ne,["prevent"]),class:"space-y-4"},[c("div",We,[c("div",Xe,[c("div",Ye,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.number")),1)]),_:1}),s(e(S),{modelValue:e(t).number,"onUpdate:modelValue":n[1]||(n[1]=r=>e(t).number=r),disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.number?(u(),_("p",Ze,i(e(t).errors.number),1)):m("",!0)]),c("div",et,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.date")),1)]),_:1}),s(e(S),{modelValue:e(t).date,"onUpdate:modelValue":n[2]||(n[2]=r=>e(t).date=r),type:"date",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.date?(u(),_("p",tt,i(e(t).errors.date),1)):m("",!0)])]),c("div",st,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.vendor")),1)]),_:1}),s(e(z),{modelValue:e(t).vendor_id,"onUpdate:modelValue":n[3]||(n[3]=r=>e(t).vendor_id=r),options:Z.value,placeholder:e(o)("contracts.select_vendor"),disabled:e(t).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(t).errors.vendor_id?(u(),_("p",at,i(e(t).errors.vendor_id),1)):m("",!0)]),c("div",ot,[c("div",lt,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.amount")),1)]),_:1}),s(e(Ee),{modelValue:e(t).amount,"onUpdate:modelValue":n[4]||(n[4]=r=>e(t).amount=r),min:0,disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.amount?(u(),_("p",rt,i(e(t).errors.amount),1)):m("",!0)]),c("div",nt,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.cooperation_type")),1)]),_:1}),s(e(z),{modelValue:e(t).cooperation_type,"onUpdate:modelValue":n[5]||(n[5]=r=>e(t).cooperation_type=r),options:ee.value,disabled:e(t).processing},null,8,["modelValue","options","disabled"]),e(t).errors.cooperation_type?(u(),_("p",it,i(e(t).errors.cooperation_type),1)):m("",!0)])]),c("div",ct,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.assigned_master")),1)]),_:1}),s(e(z),{modelValue:e(t).assigned_master_user_id,"onUpdate:modelValue":n[6]||(n[6]=r=>e(t).assigned_master_user_id=r),options:te.value,placeholder:e(o)("contracts.select_master"),disabled:e(t).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),c("p",dt,i(e(o)("contracts.master_hint")),1),e(t).errors.assigned_master_user_id?(u(),_("p",ut,i(e(t).errors.assigned_master_user_id),1)):m("",!0)]),e(t).cooperation_type==="progress"?(u(),_("div",mt,[c("div",_t,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.term_count")),1)]),_:1}),s(e(S),{"model-value":e(t).term_count??void 0,"onUpdate:modelValue":n[7]||(n[7]=r=>e(t).term_count=r?Number(r):null),type:"number",min:"1",max:"12",disabled:e(t).processing},null,8,["model-value","disabled"]),e(t).errors.term_count?(u(),_("p",pt,i(e(t).errors.term_count),1)):m("",!0)]),e(t).term_count&&e(t).term_count>0?(u(),_("div",ft,[c("div",vt,[s(e(v),null,{default:l(()=>[d(i(e(o)("contracts.term_percentages")),1)]),_:1}),c("span",{class:ve(["text-sm font-medium",O.value===100?"text-green-600":"text-destructive"])},i(e(o)("contracts.total"))+": "+i(O.value)+"% ",3)]),c("div",gt,[(u(!0),_(ge,null,be(f.value,(r,y)=>(u(),_("div",{key:y,class:"space-y-1"},[s(e(v),{class:"text-xs text-muted-foreground"},{default:l(()=>[d(i(e(o)("contracts.term"))+" "+i(y+1),1)]),_:2},1024),c("div",bt,[s(e(S),{modelValue:f.value[y],"onUpdate:modelValue":ce=>f.value[y]=ce,modelModifiers:{number:!0},type:"number",min:"0",max:"100",class:"pr-6",disabled:e(t).processing},null,8,["modelValue","onUpdate:modelValue","disabled"]),n[12]||(n[12]=c("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-sm text-muted-foreground"},"%",-1))])]))),128))]),e(t).errors.term_percentages?(u(),_("p",yt,i(e(t).errors.term_percentages),1)):m("",!0)])):m("",!0)])):m("",!0)]),s(e(q),null,{default:l(()=>[s(e(h),{type:"button",variant:"outline",onClick:n[8]||(n[8]=r=>b.value=!1),disabled:e(t).processing},{default:l(()=>[d(i(e(o)("common.cancel")),1)]),_:1},8,["disabled"]),s(e(h),{type:"submit",disabled:e(t).processing},{default:l(()=>[d(i(e(t).processing?e(o)("common.saving"):e(o)("common.save")),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),s(e(I),{open:V.value,"onUpdate:open":n[11]||(n[11]=r=>V.value=r)},{default:l(()=>[s(e(P),{class:"sm:max-w-[400px]"},{default:l(()=>[s(e(T),null,{default:l(()=>[s(e(j),null,{default:l(()=>[d(i(e(o)("common.confirm_delete")),1)]),_:1}),s(e(B),null,{default:l(()=>[d(i(e(o)("contracts.delete_confirmation",{number:p.value?.number})),1)]),_:1})]),_:1}),s(e(q),null,{default:l(()=>[s(e(h),{variant:"outline",onClick:n[10]||(n[10]=r=>V.value=!1)},{default:l(()=>[d(i(e(o)("common.cancel")),1)]),_:1}),s(e(h),{variant:"destructive",onClick:ie},{default:l(()=>[d(i(e(o)("common.delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Qt as default};
