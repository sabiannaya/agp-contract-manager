import{d as z,u as A,o as E,a as L,w as C,c as P,b as c,e as n,f as e,h as R,g as i,i as G,j as p,t as a,k as d,l as u,m as _,n as H,F as J,r as K,p as b,q as $,s as Q}from"./app-Az55F6M8.js";import{_ as W,u as X}from"./useActionConfirmation-BPstB5Uy.js";import{_ as Y}from"./Heading.vue_vue_type_script_setup_true_lang-DzT-PsX3.js";import{_ as U}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjG2TDFh.js";import{_ as Z}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-MgtW0iPC.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-9NyD3cCB.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-BatJIAlb.js";import{_ as x}from"./Select.vue_vue_type_script_setup_true_lang-C5fkymIU.js";import{i as w,_ as ee,l as te,s as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyTogOSr.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D7dEZzdR.js";import"./useForwardPropsEmits-DcGYh6Gw.js";import"./index-Dwg1ok0u.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CpvOfIA5.js";import"./useForwardExpose-Dz4tKeCh.js";import"./VisuallyHidden-C4XAoWlX.js";import"./VisuallyHiddenInput-dytHPRwB.js";import"./chevron-down-DzsoBm0Z.js";import"./createLucideIcon-iLJQO7DH.js";import"./check-CBSXup_1.js";import"./index-BDqSilVs.js";const oe={class:"flex flex-col gap-6 p-6"},re={class:"rounded-lg border bg-card p-6"},ae={class:"grid gap-4"},ne={class:"grid grid-cols-2 gap-4"},le={class:"space-y-2"},ie={key:0,class:"text-sm text-destructive"},de={class:"space-y-2"},ce={key:0,class:"text-sm text-destructive"},ue={class:"space-y-2"},me={key:0,class:"text-sm text-destructive"},pe={class:"grid grid-cols-2 gap-4"},_e={class:"space-y-2"},ve={key:0,class:"text-sm text-destructive"},fe={class:"space-y-2"},ge={key:0,class:"text-sm text-destructive"},be={class:"space-y-2"},ye={class:"text-xs text-muted-foreground"},xe={key:0,class:"text-sm text-destructive"},Ve={key:0,class:"space-y-4 rounded-lg border p-4"},he={class:"space-y-2"},ke={key:0,class:"text-sm text-destructive"},Ce={key:0,class:"space-y-2"},$e={class:"flex items-center justify-between"},Ue={class:"grid grid-cols-4 gap-2"},we={class:"relative"},Fe={key:0,class:"text-sm text-destructive"},De={class:"flex justify-end gap-2"},We=z({__name:"Create",props:{eligibleMasters:{}},setup(F){const D=F,{t:s}=A(),m=X(),N=[{title:s("nav.contracts"),href:w().url},{title:s("contracts.create"),href:"#"}],V=$([]);async function T(){const r=await fetch(te().url);V.value=await r.json()}E(T);const h=b(()=>V.value.map(r=>({value:r.id,label:`${r.code} - ${r.name}`}))),M=b(()=>[{value:"routine",label:s("contracts.types.routine")},{value:"progress",label:s("contracts.types.progress")}]),S=b(()=>(D.eligibleMasters??[]).map(r=>({value:r.id,label:`${r.name} (${r.email})`}))),t=L({number:"",date:new Date().toISOString().split("T")[0],vendor_id:null,amount:0,cooperation_type:"routine",term_count:null,term_percentages:[],is_active:!0,assigned_master_user_id:null}),f=$([]);C(()=>t.term_count,r=>{if(r&&r>0){const o=[...f.value];if(r>o.length)for(let l=o.length;l<r;l++)o.push(0);else o.splice(r);f.value=o,t.term_percentages=o}else f.value=[],t.term_percentages=[]}),C(f,r=>{t.term_percentages=[...r]},{deep:!0});const k=b(()=>f.value.reduce((r,o)=>r+(o||0),0));function j(r){return r==null?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function B(){t.post(se().url)}function I(){m.requestConfirmation({title:s("common.create"),description:s("contracts.create_description"),confirmText:s("common.save"),details:[{label:s("contracts.number"),value:t.number||"-"},{label:s("contracts.vendor"),value:h.value.find(r=>r.value===t.vendor_id)?.label??"-"},{label:s("contracts.amount"),value:j(t.amount??0)}]},B)}function O(){Q.get(w().url)}return(r,o)=>(d(),P(ee,{breadcrumbs:N},{default:c(()=>[n(e(R),{title:e(s)("contracts.create")},null,8,["title"]),i("div",oe,[n(Y,{title:e(s)("contracts.create"),description:e(s)("contracts.create_description")},null,8,["title","description"]),i("div",re,[i("form",{onSubmit:G(I,["prevent"]),class:"space-y-4"},[i("div",ae,[i("div",ne,[i("div",le,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.number")),1)]),_:1}),n(e(y),{modelValue:e(t).number,"onUpdate:modelValue":o[0]||(o[0]=l=>e(t).number=l),disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.number?(d(),u("p",ie,a(e(t).errors.number),1)):_("",!0)]),i("div",de,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.date")),1)]),_:1}),n(e(y),{modelValue:e(t).date,"onUpdate:modelValue":o[1]||(o[1]=l=>e(t).date=l),type:"date",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.date?(d(),u("p",ce,a(e(t).errors.date),1)):_("",!0)])]),i("div",ue,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.vendor")),1)]),_:1}),n(e(x),{modelValue:e(t).vendor_id,"onUpdate:modelValue":o[2]||(o[2]=l=>e(t).vendor_id=l),options:h.value,placeholder:e(s)("contracts.select_vendor"),disabled:e(t).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(t).errors.vendor_id?(d(),u("p",me,a(e(t).errors.vendor_id),1)):_("",!0)]),i("div",pe,[i("div",_e,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.amount")),1)]),_:1}),n(e(Z),{modelValue:e(t).amount,"onUpdate:modelValue":o[3]||(o[3]=l=>e(t).amount=l),min:0,disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.amount?(d(),u("p",ve,a(e(t).errors.amount),1)):_("",!0)]),i("div",fe,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.cooperation_type")),1)]),_:1}),n(e(x),{modelValue:e(t).cooperation_type,"onUpdate:modelValue":o[4]||(o[4]=l=>e(t).cooperation_type=l),options:M.value,disabled:e(t).processing},null,8,["modelValue","options","disabled"]),e(t).errors.cooperation_type?(d(),u("p",ge,a(e(t).errors.cooperation_type),1)):_("",!0)])]),i("div",be,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.assigned_master")),1)]),_:1}),n(e(x),{modelValue:e(t).assigned_master_user_id,"onUpdate:modelValue":o[5]||(o[5]=l=>e(t).assigned_master_user_id=l),options:S.value,placeholder:e(s)("contracts.select_master"),disabled:e(t).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),i("p",ye,a(e(s)("contracts.master_hint")),1),e(t).errors.assigned_master_user_id?(d(),u("p",xe,a(e(t).errors.assigned_master_user_id),1)):_("",!0)]),e(t).cooperation_type==="progress"?(d(),u("div",Ve,[i("div",he,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.term_count")),1)]),_:1}),n(e(y),{"model-value":e(t).term_count??void 0,"onUpdate:modelValue":o[6]||(o[6]=l=>e(t).term_count=l?Number(l):null),type:"number",min:"1",max:"12",disabled:e(t).processing},null,8,["model-value","disabled"]),e(t).errors.term_count?(d(),u("p",ke,a(e(t).errors.term_count),1)):_("",!0)]),e(t).term_count&&e(t).term_count>0?(d(),u("div",Ce,[i("div",$e,[n(e(v),null,{default:c(()=>[p(a(e(s)("contracts.term_percentages")),1)]),_:1}),i("span",{class:H(["text-sm font-medium",k.value===100?"text-green-600":"text-destructive"])},a(e(s)("contracts.total"))+": "+a(k.value)+"% ",3)]),i("div",Ue,[(d(!0),u(J,null,K(f.value,(l,g)=>(d(),u("div",{key:g,class:"space-y-1"},[n(e(v),{class:"text-xs text-muted-foreground"},{default:c(()=>[p(a(e(s)("contracts.term"))+" "+a(g+1),1)]),_:2},1024),i("div",we,[n(e(y),{modelValue:f.value[g],"onUpdate:modelValue":q=>f.value[g]=q,modelModifiers:{number:!0},type:"number",min:"0",max:"100",class:"pr-6",disabled:e(t).processing},null,8,["modelValue","onUpdate:modelValue","disabled"]),o[8]||(o[8]=i("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-sm text-muted-foreground"},"%",-1))])]))),128))]),e(t).errors.term_percentages?(d(),u("p",Fe,a(e(t).errors.term_percentages),1)):_("",!0)])):_("",!0)])):_("",!0)]),i("div",De,[n(e(U),{type:"button",variant:"outline",onClick:O,disabled:e(t).processing},{default:c(()=>[p(a(e(s)("common.cancel")),1)]),_:1},8,["disabled"]),n(e(U),{type:"submit",disabled:e(t).processing},{default:c(()=>[p(a(e(t).processing?e(s)("common.saving"):e(s)("common.save")),1)]),_:1},8,["disabled"])])],32)])]),n(W,{open:e(m).open.value,"onUpdate:open":o[7]||(o[7]=l=>e(m).open.value=l),title:e(m).title.value,description:e(m).description.value,"confirm-text":e(m).confirmText.value,"cancel-text":e(m).cancelText.value,destructive:e(m).destructive.value,details:e(m).details.value,onConfirm:e(m).confirm,onCancel:e(m).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"])]),_:1}))}});export{We as default};
