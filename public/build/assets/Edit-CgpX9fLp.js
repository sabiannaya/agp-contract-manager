import{d as ae,u as oe,a as le,w as M,r as w,c as ne,b as l,e as t,f as e,h as ie,g as i,l as de,j as r,t as a,i as m,m as _,k as v,F as ce,p as re,s as x,q as S}from"./app-CuI7LdXL.js";import{_ as ue}from"./Heading.vue_vue_type_script_setup_true_lang-BHjUqA3V.js";import{_ as j}from"./index-D_NX9Eof.js";import{_ as $}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BUBYiqAX.js";import{_ as E,a as T,b as N,c as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-BhpnJ5ya.js";import{_ as B}from"./CardDescription.vue_vue_type_script_setup_true_lang-D4LN3jrC.js";import{_ as me}from"./Checkbox.vue_vue_type_script_setup_true_lang-BHWKOiH2.js";import{_ as _e}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-BsyeBIW3.js";import{_ as fe,a as pe,b as ve,c as ke,d as be}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C-SfElTY.js";import{_ as ge}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Bw_2LaqB.js";import{D as C,U as P,_ as xe}from"./models-BBd9SIsc.js";import{_ as R}from"./Input.vue_vue_type_script_setup_true_lang-DLaguvqt.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-BVYJy_EQ.js";import{_ as K}from"./Select.vue_vue_type_script_setup_true_lang-QPZrs6lE.js";import{_ as he}from"./StatusBadge.vue_vue_type_script_setup_true_lang-MmS8OP8w.js";import{_ as ye}from"./Textarea.vue_vue_type_script_setup_true_lang-BYhBP41M.js";import{r as $e,F as X,d as Ve,t as De,h as I,w as we}from"./AppLayout.vue_vue_type_script_setup_true_lang-CwkbJi7E.js";import{p as Ce,s as Fe,d as Se}from"./index-PwX051BP.js";import{A as ze}from"./arrow-left-DWqgfXPD.js";import{D as Ue}from"./dollar-sign-DkALKasg.js";import{E as je}from"./eye-CwGG716I.js";import{T as Y}from"./trash-2-C9QLNDK2.js";import{S as Ee}from"./save-BUK-ELRm.js";import"./index-BRm__Hk1.js";import"./useForwardPropsEmits-CaKxx7wQ.js";import"./VisuallyHidden-DxCKGmrj.js";import"./useForwardExpose-D4WvoR71.js";import"./VisuallyHiddenInput-8nto7-pU.js";import"./check-CLJgvc3L.js";import"./createLucideIcon-CX-op3lg.js";import"./chevron-down-DGBHzGpy.js";import"./index-BDqSilVs.js";const Te={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ne={class:"flex items-center gap-4"},Oe={class:"grid gap-4 sm:grid-cols-2"},Be={class:"space-y-2"},Ie={class:"text-xs text-muted-foreground"},qe={class:"space-y-2"},Ae={key:0,class:"text-sm text-destructive"},Le={class:"space-y-2"},Me={key:0,class:"text-sm text-destructive"},Pe={class:"space-y-2"},Re={key:0,class:"text-sm text-destructive"},Ke={class:"space-y-2 sm:col-span-2"},Xe={key:0,class:"text-sm text-destructive"},Ye={class:"flex items-center space-x-2"},Ge={class:"grid gap-4 sm:grid-cols-2"},He={class:"space-y-2"},Je={key:0,class:"text-xs text-muted-foreground"},Qe={key:1,class:"text-xs text-muted-foreground"},We={key:2,class:"text-sm text-destructive"},Ze={class:"space-y-2"},et={key:0,class:"rounded-lg border bg-muted/30 p-4"},tt={class:"mb-3 text-sm font-medium"},st={class:"grid gap-3 sm:grid-cols-3"},at={class:"text-muted-foreground text-xs"},ot={class:"font-semibold"},lt={class:"text-muted-foreground text-xs"},nt={class:"font-semibold text-green-600"},it={class:"text-muted-foreground text-xs"},dt={class:"font-semibold text-orange-600"},ct={key:0,class:"mt-3"},rt={class:"flex items-center justify-between"},ut={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},mt={class:"flex items-center justify-between"},_t={key:0,class:"space-y-3"},ft={class:"rounded-md bg-muted/50 dark:bg-muted/20 p-3 border border-border/50 dark:border-border/30"},pt={class:"flex items-start gap-2"},vt={class:"flex-1 text-sm font-medium text-foreground dark:text-foreground/90 break-all leading-relaxed"},kt={class:"flex gap-2"},bt=["href"],gt={key:1,class:"space-y-2"},xt={key:0,class:"flex items-center gap-2 text-xs text-primary dark:text-primary/90 animate-pulse"},ht={class:"mt-4 text-xs text-muted-foreground"},yt={class:"flex items-center justify-end gap-4"},ts=ae({__name:"Edit",props:{ticket:{},vendors:{},contracts:{}},setup(f){const u=f,{t:s}=oe(),k=$e(),G=x(()=>[{title:s("nav.tickets"),href:De().url},{title:u.ticket.number,href:I(u.ticket.id).url},{title:s("common.edit"),href:"#"}]),H=x(()=>o.vendor_id?u.contracts.filter(d=>d.vendor_id===o.vendor_id):u.contracts),J=x(()=>u.vendors.map(d=>({value:d.id,label:`${d.code} - ${d.name}`}))),Q=x(()=>H.value.map(d=>({value:d.id,label:d.number}))),o=le({date:u.ticket.date,contract_id:u.ticket.contract_id,vendor_id:u.ticket.vendor_id,amount:u.ticket.amount,reference_no:u.ticket.reference_no??"",replaces_ticket_id:u.ticket.replaces_ticket_id,notes:u.ticket.notes??"",is_active:u.ticket.is_active}),b=x(()=>o.contract_id?u.contracts.find(d=>d.id===o.contract_id)??null:null);function z(d){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d)}M(()=>o.vendor_id,d=>{if(d&&o.contract_id){const c=u.contracts.find(n=>n.id===o.contract_id);c&&c.vendor_id!==d&&(o.contract_id=null)}}),M(()=>o.contract_id,d=>{if(d){const c=u.contracts.find(n=>n.id===d);c&&(o.vendor_id=c.vendor_id)}});function q(){S.get(I(u.ticket.id).url)}function W(){o.put(we(u.ticket.id).url,{preserveScroll:!0,onSuccess:()=>{k.success(s("tickets.updated_successfully")),S.visit(I(u.ticket.id).url)},onError:()=>{k.error(s("tickets.update_failed"))}})}const A=w(Object.fromEntries(C.map(d=>[d,null]))),F=w(null),h=w(null),V=w(!1),y=w(null),L=x(()=>u.ticket.documents??[]),U=x(()=>{const d=C.filter(c=>L.value.some(n=>n.type===c)).length;return{count:d,total:C.length,isComplete:d>=C.length}});function g(d){return L.value.find(c=>c.type===d)}async function Z(d,c){if(c){F.value=d;try{const n=new FormData;n.append("file",c),n.append("ticket_id",String(u.ticket.id)),n.append("type",d);const D=await fetch(Fe().url,{method:"POST",body:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content??""}});if(D.ok)k.success(s("documents.uploaded_successfully")),S.reload({only:["ticket"]});else{const se=await D.json();k.error(se.message||s("documents.upload_failed"))}}catch{k.error(s("documents.upload_failed"))}finally{F.value=null,A.value[d]=null}}}function ee(d){y.value=d,V.value=!0}function te(){y.value&&(h.value=y.value.id,S.delete(Se(y.value.id).url,{preserveScroll:!0,onSuccess:()=>{k.success(s("documents.deleted_successfully")),V.value=!1,y.value=null,h.value=null},onError:()=>{k.error(s("documents.delete_failed"))},onFinish:()=>{h.value=null}}))}return(d,c)=>(m(),ne(Ve,{breadcrumbs:G.value},{default:l(()=>[t(e(ie),{title:`${e(s)("common.edit")} - ${f.ticket.number}`},null,8,["title"]),i("div",Te,[i("div",Ne,[t(e($),{variant:"outline",size:"icon",onClick:q},{default:l(()=>[t(e(ze),{class:"size-4"})]),_:1}),t(ue,{title:`${e(s)("tickets.edit")} - ${f.ticket.number}`,description:e(s)("tickets.edit_description")},null,8,["title","description"])]),i("form",{onSubmit:de(W,["prevent"]),class:"space-y-6"},[t(e(E),null,{default:l(()=>[t(e(T),null,{default:l(()=>[t(e(N),{class:"flex items-center gap-2"},{default:l(()=>[t(e(X),{class:"size-5"}),r(" "+a(e(s)("tickets.ticket_info")),1)]),_:1}),t(e(B),null,{default:l(()=>[r(a(e(s)("tickets.edit_info_description")),1)]),_:1})]),_:1}),t(e(O),{class:"space-y-4"},{default:l(()=>[i("div",Oe,[i("div",Be,[t(e(p),null,{default:l(()=>[r(a(e(s)("tickets.number")),1)]),_:1}),t(e(R),{"model-value":f.ticket.number,disabled:""},null,8,["model-value"]),i("p",Ie,a(e(s)("tickets.number_readonly")),1)]),i("div",qe,[t(e(p),null,{default:l(()=>[r(a(e(s)("tickets.date")),1)]),_:1}),t(e(R),{modelValue:e(o).date,"onUpdate:modelValue":c[0]||(c[0]=n=>e(o).date=n),type:"date",disabled:e(o).processing},null,8,["modelValue","disabled"]),e(o).errors.date?(m(),_("p",Ae,a(e(o).errors.date),1)):v("",!0)]),i("div",Le,[t(e(p),null,{default:l(()=>[r(a(e(s)("tickets.vendor")),1)]),_:1}),t(e(K),{modelValue:e(o).vendor_id,"onUpdate:modelValue":c[1]||(c[1]=n=>e(o).vendor_id=n),options:J.value,placeholder:e(s)("tickets.select_vendor"),disabled:e(o).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(o).errors.vendor_id?(m(),_("p",Me,a(e(o).errors.vendor_id),1)):v("",!0)]),i("div",Pe,[t(e(p),null,{default:l(()=>[r(a(e(s)("tickets.contract")),1)]),_:1}),t(e(K),{modelValue:e(o).contract_id,"onUpdate:modelValue":c[2]||(c[2]=n=>e(o).contract_id=n),options:Q.value,placeholder:e(s)("tickets.select_contract"),disabled:e(o).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(o).errors.contract_id?(m(),_("p",Re,a(e(o).errors.contract_id),1)):v("",!0)]),i("div",Ke,[t(e(p),null,{default:l(()=>[r(a(e(s)("tickets.notes")),1)]),_:1}),t(e(ye),{modelValue:e(o).notes,"onUpdate:modelValue":c[3]||(c[3]=n=>e(o).notes=n),placeholder:e(s)("tickets.notes_placeholder"),disabled:e(o).processing,rows:3},null,8,["modelValue","placeholder","disabled"]),e(o).errors.notes?(m(),_("p",Xe,a(e(o).errors.notes),1)):v("",!0)]),i("div",Ye,[t(e(me),{id:"is_active",checked:e(o).is_active,"onUpdate:checked":c[4]||(c[4]=n=>e(o).is_active=n),disabled:e(o).processing},null,8,["checked","disabled"]),t(e(p),{for:"is_active",class:"font-normal"},{default:l(()=>[r(a(e(s)("common.active")),1)]),_:1})])])]),_:1})]),_:1}),t(e(E),null,{default:l(()=>[t(e(T),null,{default:l(()=>[t(e(N),{class:"flex items-center gap-2"},{default:l(()=>[t(e(Ue),{class:"size-5"}),r(" "+a(e(s)("tickets.payment_amount")),1)]),_:1}),t(e(B),null,{default:l(()=>[r(a(e(s)("tickets.payment_amount_description")),1)]),_:1})]),_:1}),t(e(O),{class:"space-y-4"},{default:l(()=>[i("div",Ge,[i("div",He,[t(e(p),null,{default:l(()=>[r(a(e(s)("payment_tracker.amount")),1)]),_:1}),t(e(_e),{modelValue:e(o).amount,"onUpdate:modelValue":c[5]||(c[5]=n=>e(o).amount=n),min:0,disabled:e(o).processing||f.ticket.approval_status!=="draft"},null,8,["modelValue","disabled"]),f.ticket.approval_status!=="draft"?(m(),_("p",Je,a(e(s)("tickets.amount_locked")),1)):(m(),_("p",Qe,a(e(s)("tickets.amount_hint")),1)),e(o).errors.amount?(m(),_("p",We,a(e(o).errors.amount),1)):v("",!0)]),i("div",Ze,[t(e(p),null,{default:l(()=>[r(a(e(s)("payment_tracker.approval_status")),1)]),_:1}),t(e(j),{variant:f.ticket.approval_status==="paid"?"default":f.ticket.approval_status==="rejected"?"destructive":"secondary",class:"mt-1"},{default:l(()=>[r(a(e(s)(`payment_tracker.statuses.${f.ticket.approval_status}`)),1)]),_:1},8,["variant"])])]),b.value?(m(),_("div",et,[i("p",tt,a(e(s)("payment_tracker.contract_balance")),1),i("div",st,[i("div",null,[i("p",at,a(e(s)("contracts.amount")),1),i("p",ot,a(z(b.value.amount)),1)]),i("div",null,[i("p",lt,a(e(s)("contracts.total_paid")),1),i("p",nt,a(z(b.value.payment_total_paid??0)),1)]),i("div",null,[i("p",it,a(e(s)("contracts.outstanding_balance")),1),i("p",dt,a(z(b.value.payment_balance??b.value.amount)),1)])]),e(o).amount&&e(o).amount>(b.value.payment_balance??b.value.amount)?(m(),_("div",ct,[t(e(j),{variant:"destructive"},{default:l(()=>[r(a(e(s)("tickets.amount_exceeds_balance")),1)]),_:1})])):v("",!0)])):v("",!0)]),_:1})]),_:1}),t(e(E),null,{default:l(()=>[t(e(T),null,{default:l(()=>[i("div",rt,[i("div",null,[t(e(N),{class:"flex items-center gap-2"},{default:l(()=>[t(e(P),{class:"size-5"}),r(" "+a(e(s)("documents.title")),1)]),_:1}),t(e(B),null,{default:l(()=>[r(a(e(s)("documents.manage_description")),1)]),_:1})]),t(e(he),{variant:U.value.isComplete?"complete":"incomplete"},{default:l(()=>[r(a(U.value.count)+"/"+a(U.value.total),1)]),_:1},8,["variant"])])]),_:1}),t(e(O),null,{default:l(()=>[i("div",ut,[(m(!0),_(ce,null,re(e(C),n=>(m(),_("div",{key:n,class:"rounded-lg border p-4 space-y-3"},[i("div",mt,[t(e(p),{class:"font-medium"},{default:l(()=>[r(a(e(s)(`documents.${n}`)),1)]),_:2},1024),t(e(j),{variant:g(n)?"default":"outline",class:"text-xs"},{default:l(()=>[r(a(g(n)?e(s)("status.complete"):e(s)("status.incomplete")),1)]),_:2},1032,["variant"])]),g(n)?(m(),_("div",_t,[i("div",ft,[i("div",pt,[t(e(X),{class:"size-4 text-primary dark:text-primary/90 mt-0.5 shrink-0"}),i("span",vt,a(g(n).original_name),1)])]),i("div",kt,[i("a",{href:e(Ce)(g(n).id).url,target:"_blank",class:"inline-flex items-center justify-center gap-1.5 flex-1 h-8 text-xs rounded-md border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 transition-colors px-3"},[t(e(je),{class:"size-3.5"}),r(" "+a(e(s)("common.preview")),1)],8,bt),t(e($),{type:"button",variant:"destructive",size:"sm",class:"h-8 px-3",disabled:h.value===g(n).id,onClick:D=>ee(g(n))},{default:l(()=>[t(e(Y),{class:"size-3.5"})]),_:1},8,["disabled","onClick"])])])):(m(),_("div",gt,[t(e(xe),{"model-value":A.value[n],disabled:F.value===n,accept:".pdf,.jpg,.jpeg,.png","max-size":10240,"onUpdate:modelValue":D=>Z(n,D)},null,8,["model-value","disabled","onUpdate:modelValue"]),F.value===n?(m(),_("div",xt,[t(e(P),{class:"size-3.5"}),r(" "+a(e(s)("common.uploading")),1)])):v("",!0)]))]))),128))]),i("p",ht,a(e(s)("documents.fileTypes")),1)]),_:1})]),_:1}),i("div",yt,[t(e($),{type:"button",variant:"outline",onClick:q,disabled:e(o).processing},{default:l(()=>[r(a(e(s)("common.cancel")),1)]),_:1},8,["disabled"]),t(e($),{type:"submit",disabled:e(o).processing},{default:l(()=>[t(e(Ee),{class:"mr-2 size-4"}),r(" "+a(e(o).processing?e(s)("common.saving"):e(s)("common.save")),1)]),_:1},8,["disabled"])])],32)]),t(e(fe),{open:V.value,"onUpdate:open":c[7]||(c[7]=n=>V.value=n)},{default:l(()=>[t(e(pe),{class:"sm:max-w-100"},{default:l(()=>[t(e(ve),null,{default:l(()=>[t(e(ke),null,{default:l(()=>[r(a(e(s)("common.confirm_delete")),1)]),_:1}),t(e(be),null,{default:l(()=>[r(a(e(s)("documents.delete_confirmation",{name:y.value?.original_name})),1)]),_:1})]),_:1}),t(e(ge),null,{default:l(()=>[t(e($),{variant:"outline",onClick:c[6]||(c[6]=n=>V.value=!1),disabled:h.value!==null},{default:l(()=>[r(a(e(s)("common.cancel")),1)]),_:1},8,["disabled"]),t(e($),{variant:"destructive",onClick:te,disabled:h.value!==null},{default:l(()=>[t(e(Y),{class:"mr-2 size-4"}),r(" "+a(e(s)("common.delete")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["breadcrumbs"]))}});export{ts as default};
