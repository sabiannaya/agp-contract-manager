import{d as de,u as me,a as F,c as C,b as n,e as a,f as e,h as pe,g as r,j as i,t as s,k as u,m as _,l as m,F as _e,r as fe,v as ve,n as ke,i as V,p as G,s as $,q as z,x as ye}from"./app-Az55F6M8.js";import{_ as xe,u as ge}from"./useActionConfirmation-BPstB5Uy.js";import{_ as be}from"./Heading.vue_vue_type_script_setup_true_lang-DzT-PsX3.js";import{_ as D}from"./index-BLT0FxeU.js";import{_ as f}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjG2TDFh.js";import{_ as I,a as U,b as q,c as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-DL5VZqU4.js";import{_ as T,a as B,b as E,c as M,d as N}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D7dEZzdR.js";import{_ as R}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CpvOfIA5.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-9NyD3cCB.js";import{_ as P}from"./Label.vue_vue_type_script_setup_true_lang-BatJIAlb.js";import{u as he}from"./useDateFormat-BThD_v7S.js";import{u as $e,F as Ce,C as H,n as J,_ as Se}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyTogOSr.js";import{A as je}from"./arrow-left-DLIy3lRN.js";import{D as we}from"./dollar-sign-r0xfU81d.js";import{c as Fe}from"./createLucideIcon-iLJQO7DH.js";import"./index-Dwg1ok0u.js";import"./useForwardPropsEmits-DcGYh6Gw.js";import"./useForwardExpose-Dz4tKeCh.js";import"./VisuallyHidden-C4XAoWlX.js";import"./index-BDqSilVs.js";const K=Fe("ClockIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Ve={class:"flex h-full flex-1 flex-col gap-6 p-6"},ze={class:"flex items-center justify-between"},De={class:"flex items-center gap-4"},Ie={class:"flex items-center gap-2"},Ue={class:"grid gap-6 lg:grid-cols-2"},qe={class:"grid gap-4 sm:grid-cols-2"},Ae={class:"text-muted-foreground text-sm"},Te={class:"font-medium"},Be={class:"text-muted-foreground text-sm"},Ee={class:"font-medium"},Me={class:"text-muted-foreground text-sm"},Ne={class:"text-lg font-semibold"},Re={class:"text-muted-foreground text-sm"},Oe={class:"font-medium"},Pe={class:"text-muted-foreground text-sm"},Le={class:"font-medium"},Xe={key:0},Ge={class:"text-muted-foreground text-sm"},He={class:"font-medium"},Je={key:1},Ke={class:"text-muted-foreground text-sm"},Qe={class:"font-medium"},We={key:0,class:"border-t pt-4"},Ye={class:"text-muted-foreground text-sm"},Ze={class:"mt-1"},et={class:"grid gap-4 sm:grid-cols-2"},tt={class:"text-muted-foreground text-sm"},at={class:"text-lg font-semibold"},st={class:"text-muted-foreground text-sm"},rt={class:"text-lg font-semibold text-green-600"},nt={class:"text-muted-foreground text-sm"},ot={class:"text-lg font-semibold text-orange-600"},lt={class:"text-muted-foreground text-sm"},ct={key:0,class:"space-y-4"},it={class:"flex-1"},ut={class:"flex items-center justify-between"},dt={class:"font-medium"},mt={key:0,class:"text-muted-foreground text-sm"},pt={key:1,class:"mt-1 text-xs text-muted-foreground"},_t={key:2,class:"mt-1 text-sm"},ft={key:3,class:"mt-3 flex gap-2"},vt={key:1,class:"text-muted-foreground py-8 text-center"},kt={class:"space-y-2"},yt={class:"space-y-2"},xt={key:0,class:"text-sm text-destructive"},gt={class:"space-y-2"},Rt=de({__name:"Show",props:{ticket:{}},setup(Q){const k=Q,{t}=me(),{formatDateOnly:W,formatDateTime:Y}=he(),v=$e(),p=ge(),Z=ye(),ee=G(()=>Z.props.auth.user.id),te=G(()=>{const l=(k.ticket.approval_steps??[]).filter(o=>o.status==="pending");return l.length===0?null:(l.sort((o,h)=>o.sequence_no-h.sequence_no),l[0].id)}),ae=[{title:t("nav.payment_tracker"),href:"/payment-tracker"},{title:k.ticket.number,href:"#"}];function se(){$.get("/payment-tracker")}function S(d){return d==null?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d)}function L(d){switch(d){case"paid":return"default";case"approved":return"default";case"pending":return"secondary";case"rejected":return"destructive";default:return"outline"}}function re(d){switch(d){case"approved":return H;case"rejected":return J;default:return K}}function ne(d){switch(d){case"approved":return"text-green-600";case"rejected":return"text-red-600";default:return"text-muted-foreground"}}function X(d){return(c.contract?.approvers??[]).find(h=>h.user_id===d.approver_user_id&&h.sequence_no===d.sequence_no)?.remarks??null}const y=z(!1),x=z(!1),g=z(!1),j=F({remarks:""}),b=F({remarks:""}),w=F({reference_no:""});function oe(){j.post(`/payment-tracker/${k.ticket.id}/approve`,{onSuccess:()=>{y.value=!1,v.success(t("payment_tracker.approved_successfully")),$.reload()},onError:()=>{y.value=!1,v.error(t("payment_tracker.approve_failed"))}})}function le(){b.post(`/payment-tracker/${k.ticket.id}/reject`,{onSuccess:()=>{x.value=!1,v.success(t("payment_tracker.rejected_successfully")),$.reload()},onError:()=>{x.value=!1,v.error(t("payment_tracker.reject_failed"))}})}function ce(){w.post(`/payment-tracker/${k.ticket.id}/mark-paid`,{onSuccess:()=>{g.value=!1,v.success(t("payment_tracker.paid_successfully")),$.reload()},onError:()=>{g.value=!1,v.error(t("payment_tracker.paid_failed"))}})}function ie(){p.requestConfirmation({title:t("payment_tracker.confirm_submit"),description:t("payment_tracker.submit_description"),confirmText:t("payment_tracker.submit_for_approval"),cancelText:t("common.cancel")},()=>ue())}function ue(){$.post(`/payment-tracker/${k.ticket.id}/submit`,{},{preserveScroll:!0,onSuccess:()=>{v.success(t("payment_tracker.submitted_successfully")),$.reload()},onError:()=>{v.error(t("payment_tracker.submit_failed"))}})}const c=k.ticket;return(d,l)=>(u(),C(Se,{breadcrumbs:ae},{default:n(()=>[a(e(pe),{title:`${e(t)("nav.payment_tracker")} - ${e(c).number}`},null,8,["title"]),r("div",Ve,[r("div",ze,[r("div",De,[a(e(f),{variant:"outline",size:"icon",onClick:se},{default:n(()=>[a(e(je),{class:"size-4"})]),_:1}),a(be,{title:e(c).number,description:e(t)("payment_tracker.ticket_payment_detail")},null,8,["title","description"])]),r("div",Ie,[a(e(D),{variant:L(e(c).approval_status)},{default:n(()=>[i(s(e(t)(`payment_tracker.statuses.${e(c).approval_status}`)),1)]),_:1},8,["variant"]),e(c).approval_status==="draft"?(u(),C(e(f),{key:0,onClick:ie},{default:n(()=>[i(s(e(t)("payment_tracker.submit_for_approval")),1)]),_:1})):_("",!0),e(c).approval_status==="approved"?(u(),C(e(f),{key:1,variant:"default",onClick:l[0]||(l[0]=o=>g.value=!0)},{default:n(()=>[a(e(we),{class:"mr-2 size-4"}),i(" "+s(e(t)("payment_tracker.mark_paid")),1)]),_:1})):_("",!0)])]),r("div",Ue,[a(e(I),null,{default:n(()=>[a(e(U),null,{default:n(()=>[a(e(q),null,{default:n(()=>[i(s(e(t)("payment_tracker.payment_info")),1)]),_:1})]),_:1}),a(e(A),{class:"space-y-4"},{default:n(()=>[r("div",qe,[r("div",null,[r("p",Ae,s(e(t)("tickets.number")),1),r("p",Te,s(e(c).number),1)]),r("div",null,[r("p",Be,s(e(t)("tickets.date")),1),r("p",Ee,s(e(W)(e(c).date)),1)]),r("div",null,[r("p",Me,s(e(t)("payment_tracker.amount")),1),r("p",Ne,s(S(e(c).amount)),1)]),r("div",null,[r("p",Re,s(e(t)("tickets.contract")),1),r("p",Oe,s(e(c).contract?.number??"-"),1)]),r("div",null,[r("p",Pe,s(e(t)("tickets.vendor")),1),r("p",Le,s(e(c).vendor?.name??"-"),1)]),e(c).reference_no?(u(),m("div",Xe,[r("p",Ge,s(e(t)("payment_tracker.reference_no")),1),r("p",He,s(e(c).reference_no),1)])):_("",!0),e(c).replaces_ticket?(u(),m("div",Je,[r("p",Ke,s(e(t)("payment_tracker.replaces")),1),r("p",Qe,s(e(c).replaces_ticket.number),1)])):_("",!0)]),e(c).notes?(u(),m("div",We,[r("p",Ye,s(e(t)("tickets.notes")),1),r("p",Ze,s(e(c).notes),1)])):_("",!0)]),_:1})]),_:1}),e(c).contract?(u(),C(e(I),{key:0},{default:n(()=>[a(e(U),null,{default:n(()=>[a(e(q),null,{default:n(()=>[i(s(e(t)("payment_tracker.contract_balance")),1)]),_:1})]),_:1}),a(e(A),{class:"space-y-4"},{default:n(()=>[r("div",et,[r("div",null,[r("p",tt,s(e(t)("contracts.amount")),1),r("p",at,s(S(e(c).contract.amount)),1)]),r("div",null,[r("p",st,s(e(t)("contracts.total_paid")),1),r("p",rt,s(S(e(c).contract.payment_total_paid??0)),1)]),r("div",null,[r("p",nt,s(e(t)("contracts.outstanding_balance")),1),r("p",ot,s(S(e(c).contract.payment_balance??e(c).contract.amount)),1)]),r("div",null,[r("p",lt,s(e(t)("contracts.cooperation_type")),1),a(e(D),{variant:e(c).contract.cooperation_type==="progress"?"default":"secondary"},{default:n(()=>[i(s(e(t)(`contracts.types.${e(c).contract.cooperation_type}`)),1)]),_:1},8,["variant"])])])]),_:1})]),_:1})):_("",!0)]),a(e(I),null,{default:n(()=>[a(e(U),null,{default:n(()=>[a(e(q),{class:"flex items-center gap-2"},{default:n(()=>[a(e(Ce),{class:"size-5"}),i(" "+s(e(t)("payment_tracker.approval_steps")),1)]),_:1})]),_:1}),a(e(A),null,{default:n(()=>[e(c).approval_steps?.length?(u(),m("div",ct,[(u(!0),m(_e,null,fe(e(c).approval_steps,o=>(u(),m("div",{key:o.id,class:"flex items-start gap-4 rounded-lg border p-4"},[(u(),C(ve(re(o.status)),{class:ke(["mt-0.5 size-5 shrink-0",ne(o.status)])},null,8,["class"])),r("div",it,[r("div",ut,[r("p",dt," #"+s(o.sequence_no)+" â€” "+s(o.approver?.name??"Unknown"),1),a(e(D),{variant:L(o.status)},{default:n(()=>[i(s(e(t)(`payment_tracker.statuses.${o.status}`)),1)]),_:2},1032,["variant"])]),o.acted_at?(u(),m("p",mt,s(e(Y)(o.acted_at)),1)):_("",!0),X(o)?(u(),m("p",pt," Reason: "+s(X(o)),1)):_("",!0),o.remarks?(u(),m("p",_t,s(o.remarks),1)):_("",!0),o.status==="pending"&&e(c).approval_status==="pending"&&o.approver_user_id===ee.value&&o.id===te.value?(u(),m("div",ft,[a(e(f),{size:"sm",onClick:l[1]||(l[1]=h=>y.value=!0)},{default:n(()=>[a(e(H),{class:"mr-1 size-4"}),i(" "+s(e(t)("payment_tracker.approve")),1)]),_:1}),a(e(f),{size:"sm",variant:"destructive",onClick:l[2]||(l[2]=h=>x.value=!0)},{default:n(()=>[a(e(J),{class:"mr-1 size-4"}),i(" "+s(e(t)("payment_tracker.reject")),1)]),_:1})])):_("",!0)])]))),128))])):(u(),m("div",vt,[a(e(K),{class:"mx-auto mb-2 size-8 opacity-50"}),r("p",null,s(e(t)("payment_tracker.no_approval_steps")),1)]))]),_:1})]),_:1})]),a(e(T),{open:y.value,"onUpdate:open":l[5]||(l[5]=o=>y.value=o)},{default:n(()=>[a(e(B),{class:"sm:max-w-[400px]"},{default:n(()=>[a(e(E),null,{default:n(()=>[a(e(M),null,{default:n(()=>[i(s(e(t)("payment_tracker.confirm_approve")),1)]),_:1}),a(e(N),null,{default:n(()=>[i(s(e(t)("payment_tracker.approve_description")),1)]),_:1})]),_:1}),r("form",{onSubmit:V(oe,["prevent"]),class:"space-y-4"},[r("div",kt,[a(e(P),null,{default:n(()=>[i(s(e(t)("payment_tracker.remarks")),1)]),_:1}),a(e(O),{modelValue:e(j).remarks,"onUpdate:modelValue":l[3]||(l[3]=o=>e(j).remarks=o),placeholder:e(t)("payment_tracker.remarks_placeholder")},null,8,["modelValue","placeholder"])]),a(e(R),null,{default:n(()=>[a(e(f),{type:"button",variant:"outline",onClick:l[4]||(l[4]=o=>y.value=!1)},{default:n(()=>[i(s(e(t)("common.cancel")),1)]),_:1}),a(e(f),{type:"submit",disabled:e(j).processing},{default:n(()=>[i(s(e(t)("payment_tracker.approve")),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),a(e(T),{open:x.value,"onUpdate:open":l[8]||(l[8]=o=>x.value=o)},{default:n(()=>[a(e(B),{class:"sm:max-w-[400px]"},{default:n(()=>[a(e(E),null,{default:n(()=>[a(e(M),null,{default:n(()=>[i(s(e(t)("payment_tracker.confirm_reject")),1)]),_:1}),a(e(N),null,{default:n(()=>[i(s(e(t)("payment_tracker.reject_description")),1)]),_:1})]),_:1}),r("form",{onSubmit:V(le,["prevent"]),class:"space-y-4"},[r("div",yt,[a(e(P),null,{default:n(()=>[i(s(e(t)("payment_tracker.remarks"))+" *",1)]),_:1}),a(e(O),{modelValue:e(b).remarks,"onUpdate:modelValue":l[6]||(l[6]=o=>e(b).remarks=o),placeholder:e(t)("payment_tracker.remarks_placeholder"),required:""},null,8,["modelValue","placeholder"]),e(b).errors.remarks?(u(),m("p",xt,s(e(b).errors.remarks),1)):_("",!0)]),a(e(R),null,{default:n(()=>[a(e(f),{type:"button",variant:"outline",onClick:l[7]||(l[7]=o=>x.value=!1)},{default:n(()=>[i(s(e(t)("common.cancel")),1)]),_:1}),a(e(f),{type:"submit",variant:"destructive",disabled:e(b).processing},{default:n(()=>[i(s(e(t)("payment_tracker.reject")),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),a(xe,{open:e(p).open.value,"onUpdate:open":l[9]||(l[9]=o=>e(p).open.value=o),title:e(p).title.value,description:e(p).description.value,"confirm-text":e(p).confirmText.value,"cancel-text":e(p).cancelText.value,destructive:e(p).destructive.value,details:e(p).details.value,onConfirm:e(p).confirm,onCancel:e(p).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"]),a(e(T),{open:g.value,"onUpdate:open":l[12]||(l[12]=o=>g.value=o)},{default:n(()=>[a(e(B),{class:"sm:max-w-[400px]"},{default:n(()=>[a(e(E),null,{default:n(()=>[a(e(M),null,{default:n(()=>[i(s(e(t)("payment_tracker.confirm_paid")),1)]),_:1}),a(e(N),null,{default:n(()=>[i(s(e(t)("payment_tracker.paid_description")),1)]),_:1})]),_:1}),r("form",{onSubmit:V(ce,["prevent"]),class:"space-y-4"},[r("div",gt,[a(e(P),null,{default:n(()=>[i(s(e(t)("payment_tracker.reference_no")),1)]),_:1}),a(e(O),{modelValue:e(w).reference_no,"onUpdate:modelValue":l[10]||(l[10]=o=>e(w).reference_no=o),placeholder:e(t)("payment_tracker.reference_placeholder")},null,8,["modelValue","placeholder"])]),a(e(R),null,{default:n(()=>[a(e(f),{type:"button",variant:"outline",onClick:l[11]||(l[11]=o=>g.value=!1)},{default:n(()=>[i(s(e(t)("common.cancel")),1)]),_:1}),a(e(f),{type:"submit",disabled:e(w).processing},{default:n(()=>[i(s(e(t)("payment_tracker.mark_paid")),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Rt as default};
