import{d as H,u as K,l as v,g as t,e as l,b as d,j as p,t as n,f as e,F as R,r as P,n as $,p as Z,m as w,c as O,k as u,C as ee,w as te,q as S,h as se,z as X,D as oe,E as ne,s as V}from"./app-Az55F6M8.js";import{_ as ae,u as le}from"./useActionConfirmation-BPstB5Uy.js";import{c as A,_ as z}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjG2TDFh.js";import{D as C,_ as ie,U as re}from"./models-CBHEESoR.js";import{_ as Y}from"./StatusBadge.vue_vue_type_script_setup_true_lang-Ik7GkR5h.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-BatJIAlb.js";import{_ as de}from"./Heading.vue_vue_type_script_setup_true_lang-DzT-PsX3.js";import{_ as ce,a as ue,b as me,c as fe,d as pe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D7dEZzdR.js";import{_ as _e}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CpvOfIA5.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-9NyD3cCB.js";import{_ as ve}from"./Pagination.vue_vue_type_script_setup_true_lang-DOeNEDps.js";import{u as ge}from"./useDateFormat-BThD_v7S.js";import{G as q,X as be,H as he,F as xe,_ as ke,g as ye}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyTogOSr.js";import{s as we,d as $e}from"./index-PwX051BP.js";import{c as Ce}from"./createLucideIcon-iLJQO7DH.js";import{C as De}from"./chevron-down-DzsoBm0Z.js";import{E as Fe}from"./eye-CfgMQgEh.js";import{u as Se}from"./index-Dwg1ok0u.js";import"./useForwardExpose-Dz4tKeCh.js";import"./useForwardPropsEmits-DcGYh6Gw.js";import"./VisuallyHidden-C4XAoWlX.js";import"./index-BDqSilVs.js";const Ve=Ce("FilterIcon",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ze={class:"flex items-center justify-between"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te={class:"text-sm"},Ee=["href"],je={class:"text-xs text-muted-foreground"},Oe=H({__name:"DocumentUploadGrid",props:{documents:{},files:{},disabled:{type:Boolean},readonly:{type:Boolean},class:{}},emits:["update:files","remove"],setup(_,{emit:D}){const o=_,N=D,{t:x}=K(),m=Z(()=>{const f=C.filter(h=>{const c=o.documents.some(I=>I.type===h),b=o.files[h];return c||b}).length;return{count:f,total:C.length,isComplete:f>=C.length}});function k(f){return o.documents.find(h=>h.type===f)}function i(f,h){const c={...o.files,[f]:h};N("update:files",c)}function B(f){i(f,null),N("remove",f)}return(f,h)=>(u(),v("div",{class:$(e(A)("space-y-4",o.class))},[t("div",ze,[l(e(U),{class:"text-base font-semibold"},{default:d(()=>[p(n(e(x)("documents.title")),1)]),_:1}),l(e(Y),{variant:m.value.isComplete?"complete":"incomplete"},{default:d(()=>[p(n(m.value.count)+"/"+n(m.value.total)+" "+n(e(x)("tickets.completeness")),1)]),_:1},8,["variant"])]),t("div",Ue,[(u(!0),v(R,null,P(e(C),c=>(u(),v("div",{key:c,class:"space-y-2"},[l(e(U),null,{default:d(()=>[p(n(e(x)(`documents.${c}`)),1)]),_:2},1024),_.readonly?(u(),v("div",{key:0,class:$(e(A)("flex items-center justify-between gap-2 rounded-md border p-3","border-input bg-muted/30"))},[t("span",Te,n(k(c)?.original_name??e(x)("documents.noFile")),1),k(c)?(u(),v("a",{key:0,href:`/documents/${k(c)?.id}/preview`,target:"_blank",class:"text-sm text-primary hover:underline"},n(e(x)("common.preview")),9,Ee)):w("",!0)],2)):(u(),O(e(ie),{key:1,"model-value":_.files[c],"existing-file":k(c)?{name:k(c).original_name,url:`/documents/${k(c).id}/preview`}:null,disabled:_.disabled,accept:".pdf,.jpg,.jpeg,.png","max-size":10240,"onUpdate:modelValue":b=>i(c,b),onRemove:b=>B(c)},null,8,["model-value","existing-file","disabled","onUpdate:modelValue","onRemove"]))]))),128))]),t("p",je,n(e(x)("documents.fileTypes")),1)],2))}}),Ne={class:"space-y-6"},Re={class:"flex items-center gap-2"},Be={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 p-4 border rounded-lg bg-muted/20"},Ie={class:"space-y-2"},Me={class:"space-y-2"},qe={class:"space-y-2"},Pe={class:"space-y-2"},Ge={value:""},Le={value:"complete"},Xe={value:"incomplete"},Ae={class:"rounded-md border"},He={class:"w-full caption-bottom text-sm"},Ke={class:"[&_tr]:border-b bg-muted/50"},Ye={class:"border-b"},Je={class:"h-10 px-4 text-left font-medium text-muted-foreground"},Qe={class:"h-10 px-4 text-left font-medium text-muted-foreground"},We={class:"h-10 px-4 text-left font-medium text-muted-foreground"},Ze={class:"h-10 px-4 text-left font-medium text-muted-foreground"},et={class:"h-10 px-4 text-left font-medium text-muted-foreground"},tt={class:"h-10 px-4 text-left font-medium text-muted-foreground"},st={key:0},ot={colspan:"8",class:"h-24 text-center text-muted-foreground"},nt={class:"border-b hover:bg-muted/50 transition-colors"},at={class:"px-2"},lt={class:"px-4 py-3 font-medium"},it={class:"px-4 py-3"},rt={class:"px-4 py-3"},dt={class:"px-4 py-3"},ct={class:"px-4 py-3"},ut={class:"px-4 py-3"},mt={class:"px-4 py-3"},ft={key:0},pt={colspan:"8",class:"p-4 bg-muted/20"},_t={class:"grid grid-cols-5 gap-4"},vt={class:"flex-1 min-w-0"},gt={class:"text-xs font-medium truncate"},bt={class:"text-xs text-muted-foreground truncate"},ht=["href"],Pt=H({__name:"View",props:{tickets:{},filters:{}},setup(_){const D=_,{t:o}=K(),{formatDateOnly:N}=ge(),{canUpdate:x}=ye(),m=le(),k=[{title:o("nav.view_tickets"),href:q().url}],i=ee({vendor_name:D.filters.vendor_name??"",ticket_number:D.filters.ticket_number??"",date:D.filters.date??"",status:D.filters.status??""}),B=Se(()=>{V.get(q().url,{vendor_name:i.vendor_name||void 0,ticket_number:i.ticket_number||void 0,date:i.date||void 0,status:i.status||void 0,page:1},{preserveState:!0,preserveScroll:!0})},300);te(i,B);const f=S(!1);function h(){i.vendor_name="",i.ticket_number="",i.date="",i.status="",V.get(q().url,{},{preserveState:!0,preserveScroll:!0})}function c(r){V.get(r,{},{preserveState:!0,preserveScroll:!0})}const b=S(new Set);function I(r){b.value.has(r)?b.value.delete(r):b.value.add(r)}function G(r){return{count:r.documents?.length??r.documents_count??0,total:5}}const T=S(!1),y=S(null),E=S(Object.fromEntries(C.map(r=>[r,null]))),F=S(!1);function J(r){y.value=r,E.value=Object.fromEntries(C.map(a=>[a,null])),T.value=!0}async function Q(){if(y.value){F.value=!0;try{for(const[r,a]of Object.entries(E.value))if(a){const s=new FormData;s.append("file",a),s.append("ticket_id",String(y.value.id)),s.append("type",r),await fetch(we().url,{method:"POST",body:s,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content??""}})}V.reload({only:["tickets"]}),T.value=!1}finally{F.value=!1}}}function W(r){if(!y.value)return;const a=y.value.documents?.find(s=>s.type===r);a&&m.requestConfirmation({title:o("common.confirm_delete"),description:o("documents.delete_confirmation",{name:a.original_name}),confirmText:o("common.delete"),destructive:!0,details:[{label:"File",value:a.original_name},{label:"Type",value:o(`documents.${r}`)}]},()=>{V.delete($e(a.id).url,{preserveScroll:!0,onSuccess:()=>{V.reload({only:["tickets"]})}})})}function L(r,a){return r.documents?.find(g=>g.type===a)?"exists":"missing"}return(r,a)=>(u(),O(ke,{breadcrumbs:k},{default:d(()=>[l(e(se),{title:e(o)("nav.view_tickets")},null,8,["title"]),t("div",Ne,[l(de,{title:e(o)("nav.view_tickets"),description:e(o)("tickets.view_description")},null,8,["title","description"]),t("div",Re,[l(e(z),{variant:"outline",size:"sm",onClick:a[0]||(a[0]=s=>f.value=!f.value)},{default:d(()=>[l(e(Ve),{class:"mr-2 size-4"}),p(" "+n(e(o)("common.filters"))+" ",1),l(e(De),{class:$(["ml-2 size-4 transition-transform",f.value&&"rotate-180"])},null,8,["class"])]),_:1}),Object.values(i).some(Boolean)?(u(),O(e(z),{key:0,variant:"ghost",size:"sm",onClick:h},{default:d(()=>[l(e(be),{class:"mr-2 size-4"}),p(" "+n(e(o)("common.clear_filters")),1)]),_:1})):w("",!0)]),X(t("div",Be,[t("div",Ie,[l(e(U),null,{default:d(()=>[p(n(e(o)("tickets.vendor")),1)]),_:1}),l(e(M),{modelValue:i.vendor_name,"onUpdate:modelValue":a[1]||(a[1]=s=>i.vendor_name=s),placeholder:e(o)("tickets.filter_vendor")},null,8,["modelValue","placeholder"])]),t("div",Me,[l(e(U),null,{default:d(()=>[p(n(e(o)("tickets.number")),1)]),_:1}),l(e(M),{modelValue:i.ticket_number,"onUpdate:modelValue":a[2]||(a[2]=s=>i.ticket_number=s),placeholder:e(o)("tickets.filter_number")},null,8,["modelValue","placeholder"])]),t("div",qe,[l(e(U),null,{default:d(()=>[p(n(e(o)("tickets.date")),1)]),_:1}),l(e(M),{modelValue:i.date,"onUpdate:modelValue":a[3]||(a[3]=s=>i.date=s),type:"date"},null,8,["modelValue"])]),t("div",Pe,[l(e(U),null,{default:d(()=>[p(n(e(o)("common.status")),1)]),_:1}),X(t("select",{"onUpdate:modelValue":a[4]||(a[4]=s=>i.status=s),class:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-xs focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"},[t("option",Ge,n(e(o)("common.all")),1),t("option",Le,n(e(o)("tickets.status.complete")),1),t("option",Xe,n(e(o)("tickets.status.incomplete")),1)],512),[[oe,i.status]])])],512),[[ne,f.value]]),t("div",Ae,[t("table",He,[t("thead",Ke,[t("tr",Ye,[a[9]||(a[9]=t("th",{class:"h-10 w-[40px] px-2"},null,-1)),t("th",Je,n(e(o)("tickets.number")),1),t("th",Qe,n(e(o)("tickets.date")),1),t("th",We,n(e(o)("tickets.vendor")),1),t("th",Ze,n(e(o)("tickets.contract")),1),t("th",et,n(e(o)("tickets.completeness")),1),t("th",tt,n(e(o)("common.status")),1),a[10]||(a[10]=t("th",{class:"h-10 w-[100px] px-4"},null,-1))])]),t("tbody",null,[_.tickets.data.length===0?(u(),v("tr",st,[t("td",ot,n(e(o)("common.no_data")),1)])):w("",!0),(u(!0),v(R,null,P(_.tickets.data,s=>(u(),v(R,{key:s.id},[t("tr",nt,[t("td",at,[l(e(z),{variant:"ghost",size:"icon",class:"size-8",onClick:g=>I(s.id)},{default:d(()=>[l(e(he),{class:$(["size-4 transition-transform",b.value.has(s.id)&&"rotate-90"])},null,8,["class"])]),_:2},1032,["onClick"])]),t("td",lt,n(s.number),1),t("td",it,n(e(N)(s.date)),1),t("td",rt,n(s.vendor?.name),1),t("td",dt,n(s.contract?.number),1),t("td",ct,[t("span",{class:$(["text-sm font-medium",G(s).count===5?"text-green-600":"text-amber-600"])},n(G(s).count)+"/5 ",3)]),t("td",ut,[l(e(Y),{status:s.status},null,8,["status"])]),t("td",mt,[e(x)("tickets")?(u(),O(e(z),{key:0,variant:"outline",size:"sm",onClick:g=>J(s)},{default:d(()=>[l(e(re),{class:"mr-2 size-4"}),p(" "+n(e(o)("documents.manage")),1)]),_:1},8,["onClick"])):w("",!0)])]),b.value.has(s.id)?(u(),v("tr",ft,[t("td",pt,[t("div",_t,[(u(!0),v(R,null,P(e(C),g=>(u(),v("div",{key:g,class:$(["flex items-center gap-2 p-3 rounded-md border",L(s,g)==="exists"?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950":"border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950"])},[l(e(xe),{class:$(["size-5",L(s,g)==="exists"?"text-green-600":"text-amber-600"])},null,8,["class"]),t("div",vt,[t("p",gt,n(e(o)(`documents.${g}`)),1),t("p",bt,n(s.documents?.find(j=>j.type===g)?.original_name??e(o)("documents.noFile")),1)]),s.documents?.find(j=>j.type===g)?(u(),v("a",{key:0,href:`/documents/${s.documents.find(j=>j.type===g)?.id}/preview`,target:"_blank",class:"p-1 hover:bg-background rounded"},[l(e(Fe),{class:"size-4 text-muted-foreground hover:text-foreground"})],8,ht)):w("",!0)],2))),128))])])])):w("",!0)],64))),128))])])]),l(e(ve),{links:_.tickets.links,from:_.tickets.from,to:_.tickets.to,total:_.tickets.total,onNavigate:c},null,8,["links","from","to","total"])]),l(e(ce),{open:T.value,"onUpdate:open":a[7]||(a[7]=s=>T.value=s)},{default:d(()=>[l(e(ue),{class:"sm:max-w-[700px]"},{default:d(()=>[l(e(me),null,{default:d(()=>[l(e(fe),null,{default:d(()=>[p(n(e(o)("documents.manage"))+" - "+n(y.value?.number),1)]),_:1}),l(e(pe),null,{default:d(()=>[p(n(e(o)("documents.manage_description")),1)]),_:1})]),_:1}),y.value?(u(),O(Oe,{key:0,documents:y.value.documents??[],files:E.value,"onUpdate:files":a[5]||(a[5]=s=>E.value=s),disabled:F.value,onRemove:W},null,8,["documents","files","disabled"])):w("",!0),l(e(_e),null,{default:d(()=>[l(e(z),{variant:"outline",onClick:a[6]||(a[6]=s=>T.value=!1),disabled:F.value},{default:d(()=>[p(n(e(o)("common.cancel")),1)]),_:1},8,["disabled"]),l(e(z),{onClick:Q,disabled:F.value||!Object.values(E.value).some(Boolean)},{default:d(()=>[p(n(F.value?e(o)("common.uploading"):e(o)("common.upload")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),l(ae,{open:e(m).open,"onUpdate:open":a[8]||(a[8]=s=>e(m).open=s),title:e(m).title,description:e(m).description,"confirm-text":e(m).confirmText,"cancel-text":e(m).cancelText,destructive:e(m).destructive,details:e(m).details,onConfirm:e(m).confirm,onCancel:e(m).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"])]),_:1}))}});export{Pt as default};
