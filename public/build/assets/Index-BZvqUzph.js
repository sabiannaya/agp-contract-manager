import{d as ce,u as ue,o as de,r as g,w as U,a as me,c as S,b as r,e as s,f as e,h as pe,g as u,i as d,j as c,t as i,k as m,l as _e,m as _,n as fe,F as ve,p as be,q as C,s as w}from"./app-D6ZExuG4.js";import{_ as ye}from"./Heading.vue_vue_type_script_setup_true_lang-C_Qaqaft.js";import{_ as ge}from"./index-MxVPBNtp.js";import{_ as h}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BAMJN8k7.js";import{S as xe,_ as ke}from"./DataTable.vue_vue_type_script_setup_true_lang-LbyIga0L.js";import{_ as I,a as O,b as P,c as T,d as j}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CgDzptfY.js";import{_ as B}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CmMndOaZ.js";import{i as F,_ as he,a as Ve,b as $e,c as z,d as Ce,u as Se,l as we,s as De,e as Ue,f as Fe,g as ze}from"./AppLayout.vue_vue_type_script_setup_true_lang-DhQ7Babn.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-B9Upw0KD.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-B7C0xePR.js";import{E as Me,_ as Ee}from"./Pagination.vue_vue_type_script_setup_true_lang-DIGKOJqX.js";import{_ as q}from"./Select.vue_vue_type_script_setup_true_lang-CEEQHg8s.js";import{_ as Ne}from"./StatusBadge.vue_vue_type_script_setup_true_lang-DTLVhpcY.js";import{u as Ie}from"./useDateFormat-BThD_v7S.js";import{P as Oe}from"./plus-Ocys-J35.js";import{E as Pe}from"./eye-Cfy1nj4J.js";import{P as Te}from"./pencil-BG-Ex8ol.js";import{T as je}from"./trash-2-DQ56K_0i.js";import{u as Be}from"./index-Dnaiof97.js";import"./createLucideIcon-BXqO2veZ.js";import"./Spinner.vue_vue_type_script_setup_true_lang-Di4CQ4C5.js";import"./chevron-down-DKASTZ1i.js";import"./useForwardPropsEmits-BgLpAiDO.js";import"./VisuallyHidden-D-NgPM13.js";import"./useForwardExpose-6n7ayWvE.js";import"./index-BDqSilVs.js";import"./VisuallyHiddenInput-B9UHQZYS.js";import"./check-C3XzR5eS.js";const qe={class:"flex flex-col gap-6 p-6"},Le={class:"flex items-center justify-between"},Re={class:"flex items-center gap-4"},Ae={class:"relative flex-1 max-w-sm"},Ge={class:"overflow-auto"},He={class:"sr-only"},Je={class:"shrink-0 border-t bg-background pt-4"},Ke={class:"grid gap-4"},Qe={class:"grid grid-cols-2 gap-4"},We={class:"space-y-2"},Xe={key:0,class:"text-sm text-destructive"},Ye={class:"space-y-2"},Ze={key:0,class:"text-sm text-destructive"},et={class:"space-y-2"},tt={key:0,class:"text-sm text-destructive"},st={class:"grid grid-cols-2 gap-4"},at={class:"space-y-2"},ot={key:0,class:"text-sm text-destructive"},rt={class:"space-y-2"},lt={key:0,class:"text-sm text-destructive"},nt={key:0,class:"space-y-4 border rounded-lg p-4"},it={class:"space-y-2"},ct={key:0,class:"text-sm text-destructive"},ut={key:0,class:"space-y-2"},dt={class:"flex items-center justify-between"},mt={class:"grid grid-cols-4 gap-2"},pt={class:"relative"},_t={key:0,class:"text-sm text-destructive"},Rt=ce({__name:"Index",props:{contracts:{},filters:{}},setup(x){const k=x,{t:o}=ue(),{formatDateOnly:L}=Ie(),{canCreate:R,canUpdate:A,canDelete:G}=Se(),H=[{title:o("nav.contracts"),href:F().url}],M=g([]),E=g(!1);async function J(){E.value=!0;try{const a=await fetch(we().url);M.value=await a.json()}finally{E.value=!1}}de(J);const D=g(k.filters.search??""),K=Be(a=>{C.get(F().url,{...k.filters,search:a||void 0,page:1},{preserveState:!0,preserveScroll:!0})},300);U(D,a=>K(a));function Q(a,n){C.get(F().url,{...k.filters,sort:a,direction:n},{preserveState:!0,preserveScroll:!0})}function W(a){C.get(a,{},{preserveState:!0,preserveScroll:!0})}const X=[{key:"number",label:o("contracts.number"),sortable:!0},{key:"date",label:o("contracts.date"),sortable:!0},{key:"vendor.name",label:o("contracts.vendor")},{key:"cooperation_type",label:o("contracts.cooperation_type"),sortable:!0},{key:"amount",label:o("contracts.amount"),sortable:!0,class:"text-right"},{key:"is_active",label:o("common.status"),sortable:!0},{key:"actions",label:"",class:"w-[70px]"}];function Y(a){return a==null?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}const Z=w(()=>M.value.map(a=>({value:a.id,label:`${a.code} - ${a.name}`}))),ee=w(()=>[{value:"routine",label:o("contracts.types.routine")},{value:"progress",label:o("contracts.types.progress")}]),b=g(!1),$=g(!1),p=g(null),t=me({number:"",date:new Date().toISOString().split("T")[0],vendor_id:null,amount:0,cooperation_type:"routine",term_count:null,term_percentages:[],is_active:!0}),te=w(()=>p.value?o("contracts.edit"):o("contracts.create")),f=g([]);U(()=>t.term_count,a=>{if(a&&a>0){const n=[...f.value];if(a>n.length)for(let l=n.length;l<a;l++)n.push(0);else n.splice(a);f.value=n,t.term_percentages=n}else f.value=[],t.term_percentages=[]}),U(f,a=>{t.term_percentages=[...a]},{deep:!0});const N=w(()=>f.value.reduce((a,n)=>a+(n||0),0));function se(){p.value=null,t.reset(),t.clearErrors(),f.value=[],b.value=!0}function ae(a){C.get(De(a.id).url)}function oe(a){p.value=a,t.number=a.number,t.date=a.date,t.vendor_id=a.vendor_id,t.amount=a.amount,t.cooperation_type=a.cooperation_type,t.term_count=a.term_count,t.term_percentages=a.term_percentages??[],f.value=a.term_percentages??[],t.is_active=a.is_active,t.clearErrors(),b.value=!0}function re(a){p.value=a,$.value=!0}function le(){p.value?t.put(Ue(p.value.id).url,{onSuccess:()=>{b.value=!1}}):t.post(Fe().url,{onSuccess:()=>{b.value=!1}})}function ne(){p.value&&C.delete(ze(p.value.id).url,{onSuccess:()=>{$.value=!1,p.value=null}})}return(a,n)=>(d(),S(Ce,{breadcrumbs:H},{default:r(()=>[s(e(pe),{title:e(o)("nav.contracts")},null,8,["title"]),u("div",qe,[u("div",Le,[s(ye,{title:e(o)("nav.contracts"),description:e(o)("contracts.description")},null,8,["title","description"]),e(R)("contracts")?(d(),S(e(h),{key:0,onClick:se},{default:r(()=>[s(e(Oe),{class:"mr-2 size-4"}),c(" "+i(e(o)("contracts.create")),1)]),_:1})):m("",!0)]),u("div",Re,[u("div",Ae,[s(e(xe),{class:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),s(e(V),{modelValue:D.value,"onUpdate:modelValue":n[0]||(n[0]=l=>D.value=l),placeholder:e(o)("common.search"),class:"pl-9"},null,8,["modelValue","placeholder"])])]),u("div",Ge,[s(e(ke),{columns:X,data:x.contracts.data,"sort-field":typeof k.filters.sort=="string"?k.filters.sort:void 0,"sort-direction":k.filters.direction,"empty-text":e(o)("common.no_data"),hoverable:"",onSort:Q},{"cell-cooperation_type":r(({value:l})=>[s(e(ge),{variant:l==="progress"?"default":"secondary"},{default:r(()=>[c(i(e(o)(`contracts.types.${l}`)),1)]),_:2},1032,["variant"])]),"cell-date":r(({value:l})=>[c(i(e(L)(l)),1)]),"cell-amount":r(({value:l})=>[c(i(Y(l)),1)]),"cell-is_active":r(({value:l})=>[s(e(Ne),{status:l?"active":"inactive"},null,8,["status"])]),"cell-actions":r(({row:l})=>[s(e(he),null,{default:r(()=>[s(e(Ve),{"as-child":""},{default:r(()=>[s(e(h),{variant:"ghost",size:"icon",class:"size-8"},{default:r(()=>[s(e(Me),{class:"size-4"}),u("span",He,i(e(o)("common.actions")),1)]),_:1})]),_:1}),s(e($e),{align:"end"},{default:r(()=>[s(e(z),{onClick:y=>ae(l)},{default:r(()=>[s(e(Pe),{class:"mr-2 size-4"}),c(" "+i(e(o)("common.view")),1)]),_:1},8,["onClick"]),e(A)("contracts")?(d(),S(e(z),{key:0,onClick:y=>oe(l)},{default:r(()=>[s(e(Te),{class:"mr-2 size-4"}),c(" "+i(e(o)("common.edit")),1)]),_:1},8,["onClick"])):m("",!0),e(G)("contracts")?(d(),S(e(z),{key:1,class:"text-destructive focus:text-destructive",onClick:y=>re(l)},{default:r(()=>[s(e(je),{class:"mr-2 size-4"}),c(" "+i(e(o)("common.delete")),1)]),_:1},8,["onClick"])):m("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","sort-field","sort-direction","empty-text"])]),u("div",Je,[s(e(Ee),{links:x.contracts.links,from:x.contracts.from,to:x.contracts.to,total:x.contracts.total,onNavigate:W},null,8,["links","from","to","total"])])]),s(e(I),{open:b.value,"onUpdate:open":n[8]||(n[8]=l=>b.value=l)},{default:r(()=>[s(e(O),{class:"sm:max-w-[600px]"},{default:r(()=>[s(e(P),null,{default:r(()=>[s(e(T),null,{default:r(()=>[c(i(te.value),1)]),_:1}),s(e(j),null,{default:r(()=>[c(i(p.value?e(o)("contracts.edit_description"):e(o)("contracts.create_description")),1)]),_:1})]),_:1}),u("form",{onSubmit:_e(le,["prevent"]),class:"space-y-4"},[u("div",Ke,[u("div",Qe,[u("div",We,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.number")),1)]),_:1}),s(e(V),{modelValue:e(t).number,"onUpdate:modelValue":n[1]||(n[1]=l=>e(t).number=l),disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.number?(d(),_("p",Xe,i(e(t).errors.number),1)):m("",!0)]),u("div",Ye,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.date")),1)]),_:1}),s(e(V),{modelValue:e(t).date,"onUpdate:modelValue":n[2]||(n[2]=l=>e(t).date=l),type:"date",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.date?(d(),_("p",Ze,i(e(t).errors.date),1)):m("",!0)])]),u("div",et,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.vendor")),1)]),_:1}),s(e(q),{modelValue:e(t).vendor_id,"onUpdate:modelValue":n[3]||(n[3]=l=>e(t).vendor_id=l),options:Z.value,placeholder:e(o)("contracts.select_vendor"),disabled:e(t).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(t).errors.vendor_id?(d(),_("p",tt,i(e(t).errors.vendor_id),1)):m("",!0)]),u("div",st,[u("div",at,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.amount")),1)]),_:1}),s(e(V),{modelValue:e(t).amount,"onUpdate:modelValue":n[4]||(n[4]=l=>e(t).amount=l),modelModifiers:{number:!0},type:"number",min:"0",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.amount?(d(),_("p",ot,i(e(t).errors.amount),1)):m("",!0)]),u("div",rt,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.cooperation_type")),1)]),_:1}),s(e(q),{modelValue:e(t).cooperation_type,"onUpdate:modelValue":n[5]||(n[5]=l=>e(t).cooperation_type=l),options:ee.value,disabled:e(t).processing},null,8,["modelValue","options","disabled"]),e(t).errors.cooperation_type?(d(),_("p",lt,i(e(t).errors.cooperation_type),1)):m("",!0)])]),e(t).cooperation_type==="progress"?(d(),_("div",nt,[u("div",it,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.term_count")),1)]),_:1}),s(e(V),{"model-value":e(t).term_count??void 0,"onUpdate:modelValue":n[6]||(n[6]=l=>e(t).term_count=l?Number(l):null),type:"number",min:"1",max:"12",disabled:e(t).processing},null,8,["model-value","disabled"]),e(t).errors.term_count?(d(),_("p",ct,i(e(t).errors.term_count),1)):m("",!0)]),e(t).term_count&&e(t).term_count>0?(d(),_("div",ut,[u("div",dt,[s(e(v),null,{default:r(()=>[c(i(e(o)("contracts.term_percentages")),1)]),_:1}),u("span",{class:fe(["text-sm font-medium",N.value===100?"text-green-600":"text-destructive"])},i(e(o)("contracts.total"))+": "+i(N.value)+"% ",3)]),u("div",mt,[(d(!0),_(ve,null,be(f.value,(l,y)=>(d(),_("div",{key:y,class:"space-y-1"},[s(e(v),{class:"text-xs text-muted-foreground"},{default:r(()=>[c(i(e(o)("contracts.term"))+" "+i(y+1),1)]),_:2},1024),u("div",pt,[s(e(V),{modelValue:f.value[y],"onUpdate:modelValue":ie=>f.value[y]=ie,modelModifiers:{number:!0},type:"number",min:"0",max:"100",class:"pr-6",disabled:e(t).processing},null,8,["modelValue","onUpdate:modelValue","disabled"]),n[11]||(n[11]=u("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-sm text-muted-foreground"},"%",-1))])]))),128))]),e(t).errors.term_percentages?(d(),_("p",_t,i(e(t).errors.term_percentages),1)):m("",!0)])):m("",!0)])):m("",!0)]),s(e(B),null,{default:r(()=>[s(e(h),{type:"button",variant:"outline",onClick:n[7]||(n[7]=l=>b.value=!1),disabled:e(t).processing},{default:r(()=>[c(i(e(o)("common.cancel")),1)]),_:1},8,["disabled"]),s(e(h),{type:"submit",disabled:e(t).processing},{default:r(()=>[c(i(e(t).processing?e(o)("common.saving"):e(o)("common.save")),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),s(e(I),{open:$.value,"onUpdate:open":n[10]||(n[10]=l=>$.value=l)},{default:r(()=>[s(e(O),{class:"sm:max-w-[400px]"},{default:r(()=>[s(e(P),null,{default:r(()=>[s(e(T),null,{default:r(()=>[c(i(e(o)("common.confirm_delete")),1)]),_:1}),s(e(j),null,{default:r(()=>[c(i(e(o)("contracts.delete_confirmation",{number:p.value?.number})),1)]),_:1})]),_:1}),s(e(B),null,{default:r(()=>[s(e(h),{variant:"outline",onClick:n[9]||(n[9]=l=>$.value=!1)},{default:r(()=>[c(i(e(o)("common.cancel")),1)]),_:1}),s(e(h),{variant:"destructive",onClick:ne},{default:r(()=>[c(i(e(o)("common.delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Rt as default};
