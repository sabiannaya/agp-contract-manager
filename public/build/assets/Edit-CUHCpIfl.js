import{d as ce,u as re,a as de,w as K,q as F,c as ue,b as c,e as s,f as e,h as me,g as l,i as _e,j as d,t as n,k as m,l as _,m as x,F as pe,r as fe,p as b,s as S}from"./app-Az55F6M8.js";import{_ as X,u as Y}from"./useActionConfirmation-BPstB5Uy.js";import{_ as ve}from"./Heading.vue_vue_type_script_setup_true_lang-DzT-PsX3.js";import{_ as E}from"./index-BLT0FxeU.js";import{_ as U}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjG2TDFh.js";import{_ as j,a as N,b as O,c as B}from"./CardTitle.vue_vue_type_script_setup_true_lang-DL5VZqU4.js";import{_ as q}from"./CardDescription.vue_vue_type_script_setup_true_lang-xuWwyfVh.js";import{_ as ke}from"./Checkbox.vue_vue_type_script_setup_true_lang-pmgtftpc.js";import{_ as xe}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-MgtW0iPC.js";import{D,U as G,_ as be}from"./models-CBHEESoR.js";import{_ as H}from"./Input.vue_vue_type_script_setup_true_lang-9NyD3cCB.js";import{_ as k}from"./Label.vue_vue_type_script_setup_true_lang-BatJIAlb.js";import{_ as J}from"./Select.vue_vue_type_script_setup_true_lang-C5fkymIU.js";import{_ as ge}from"./StatusBadge.vue_vue_type_script_setup_true_lang-Ik7GkR5h.js";import{_ as he}from"./Textarea.vue_vue_type_script_setup_true_lang-DKZzY7Db.js";import{u as ye,F as Q,_ as Ce,w as $e,m as A,y as De}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyTogOSr.js";import{p as Ve,s as Te,d as we}from"./index-PwX051BP.js";import{A as Fe}from"./arrow-left-DLIy3lRN.js";import{D as Se}from"./dollar-sign-r0xfU81d.js";import{E as Ue}from"./eye-CfgMQgEh.js";import{T as ze}from"./trash-2-1tc8fb7c.js";import{S as Ee}from"./save-CpSwRFrC.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D7dEZzdR.js";import"./useForwardPropsEmits-DcGYh6Gw.js";import"./index-Dwg1ok0u.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CpvOfIA5.js";import"./VisuallyHidden-C4XAoWlX.js";import"./VisuallyHiddenInput-dytHPRwB.js";import"./useForwardExpose-Dz4tKeCh.js";import"./check-CBSXup_1.js";import"./createLucideIcon-iLJQO7DH.js";import"./chevron-down-DzsoBm0Z.js";import"./index-BDqSilVs.js";const je={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ne={class:"flex items-center gap-4"},Oe={class:"grid gap-4 sm:grid-cols-2"},Be={class:"space-y-2"},qe={class:"text-xs text-muted-foreground"},Ae={class:"space-y-2"},Ie={key:0,class:"text-sm text-destructive"},Le={class:"space-y-2"},Me={key:0,class:"text-sm text-destructive"},Pe={class:"space-y-2"},Re={key:0,class:"text-sm text-destructive"},Ke={class:"space-y-2 sm:col-span-2"},Xe={key:0,class:"text-sm text-destructive"},Ye={class:"flex items-center space-x-2"},Ge={class:"grid gap-4 sm:grid-cols-2"},He={class:"space-y-2"},Je={key:0,class:"text-xs text-muted-foreground"},Qe={key:1,class:"text-xs text-muted-foreground"},We={key:2,class:"text-sm text-destructive"},Ze={class:"space-y-2"},et={key:0,class:"rounded-lg border bg-muted/30 p-4"},tt={class:"mb-3 text-sm font-medium"},st={class:"grid gap-3 sm:grid-cols-3"},at={class:"text-muted-foreground text-xs"},ot={class:"font-semibold"},nt={class:"text-muted-foreground text-xs"},it={class:"font-semibold text-green-600"},lt={class:"text-muted-foreground text-xs"},ct={class:"font-semibold text-orange-600"},rt={key:0,class:"mt-3"},dt={class:"flex items-center justify-between"},ut={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},mt={class:"flex items-center justify-between"},_t={key:0,class:"space-y-3"},pt={class:"rounded-md bg-muted/50 dark:bg-muted/20 p-3 border border-border/50 dark:border-border/30"},ft={class:"flex items-start gap-2"},vt={class:"flex-1 text-sm font-medium text-foreground dark:text-foreground/90 break-all leading-relaxed"},kt={class:"flex gap-2"},xt=["href"],bt={key:1,class:"space-y-2"},gt={key:0,class:"flex items-center gap-2 text-xs text-primary dark:text-primary/90 animate-pulse"},ht={class:"mt-4 text-xs text-muted-foreground"},yt={class:"flex items-center justify-end gap-4"},ss=ce({__name:"Edit",props:{ticket:{},vendors:{},contracts:{}},setup(v){const u=v,{t}=re(),g=ye(),p=Y(),f=Y(),W=b(()=>[{title:t("nav.tickets"),href:$e().url},{title:u.ticket.number,href:A(u.ticket.id).url},{title:t("common.edit"),href:"#"}]),Z=b(()=>a.vendor_id?u.contracts.filter(o=>o.vendor_id===a.vendor_id):[]),I=b(()=>u.vendors.map(o=>({value:o.id,label:`${o.code} - ${o.name}`}))),L=b(()=>Z.value.map(o=>({value:o.id,label:o.number}))),ee=b(()=>a.processing||!a.vendor_id);function te(o){return o?String(o).slice(0,10):""}const a=de({date:te(u.ticket.date),contract_id:u.ticket.contract_id,vendor_id:u.ticket.vendor_id,amount:u.ticket.amount,reference_no:u.ticket.reference_no??"",replaces_ticket_id:u.ticket.replaces_ticket_id,notes:u.ticket.notes??"",is_active:u.ticket.is_active}),h=b(()=>a.contract_id?u.contracts.find(o=>o.id===a.contract_id)??null:null);function V(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o)}K(()=>a.vendor_id,o=>{if(!o){a.contract_id=null;return}if(o&&a.contract_id){const r=u.contracts.find(i=>i.id===a.contract_id);r&&r.vendor_id!==o&&(a.contract_id=null)}}),K(()=>a.contract_id,o=>{if(o){const r=u.contracts.find(i=>i.id===o);r&&(a.vendor_id=r.vendor_id)}});function M(){S.get(A(u.ticket.id).url)}function se(){a.put(De(u.ticket.id).url,{preserveScroll:!0,onSuccess:()=>{g.success(t("tickets.updated_successfully")),S.visit(A(u.ticket.id).url)},onError:()=>{g.error(t("tickets.update_failed"))}})}function ae(){p.requestConfirmation({title:t("common.update"),description:t("tickets.edit_description"),confirmText:t("common.save"),details:[{label:t("tickets.number"),value:u.ticket.number},{label:t("tickets.vendor"),value:I.value.find(o=>o.value===a.vendor_id)?.label??"-"},{label:t("tickets.contract"),value:L.value.find(o=>o.value===a.contract_id)?.label??"-"},{label:t("payment_tracker.amount"),value:a.amount?V(a.amount):"-"}]},se)}const P=F(Object.fromEntries(D.map(o=>[o,null]))),T=F(null),w=F(null),C=F(null),R=b(()=>u.ticket.documents??[]),z=b(()=>{const o=D.filter(r=>R.value.some(i=>i.type===r)).length;return{count:o,total:D.length,isComplete:o>=D.length}});function y(o){return R.value.find(r=>r.type===o)}async function oe(o,r){if(r){T.value=o;try{const i=new FormData;i.append("file",r),i.append("ticket_id",String(u.ticket.id)),i.append("type",o);const $=await fetch(Te().url,{method:"POST",body:i,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content??""}});if($.ok)g.success(t("documents.uploaded_successfully")),S.reload({only:["ticket"]});else{const le=await $.json();g.error(le.message||t("documents.upload_failed"))}}catch{g.error(t("documents.upload_failed"))}finally{T.value=null,P.value[o]=null}}}function ne(o){C.value=o,f.requestConfirmation({title:t("common.confirm_delete"),description:t("documents.delete_confirmation",{name:o.original_name}),confirmText:t("common.delete"),destructive:!0,details:[{label:"File",value:o.original_name},{label:"Type",value:t(`documents.${o.type}`)}]},ie)}function ie(){C.value&&(w.value=C.value.id,S.delete(we(C.value.id).url,{preserveScroll:!0,onSuccess:()=>{g.success(t("documents.deleted_successfully")),C.value=null,w.value=null},onError:()=>{g.error(t("documents.delete_failed"))},onFinish:()=>{w.value=null}}))}return(o,r)=>(m(),ue(Ce,{breadcrumbs:W.value},{default:c(()=>[s(e(me),{title:`${e(t)("common.edit")} - ${v.ticket.number}`},null,8,["title"]),l("div",je,[l("div",Ne,[s(e(U),{variant:"outline",size:"icon",onClick:M},{default:c(()=>[s(e(Fe),{class:"size-4"})]),_:1}),s(ve,{title:`${e(t)("tickets.edit")} - ${v.ticket.number}`,description:e(t)("tickets.edit_description")},null,8,["title","description"])]),l("form",{onSubmit:_e(ae,["prevent"]),class:"space-y-6"},[s(e(j),null,{default:c(()=>[s(e(N),null,{default:c(()=>[s(e(O),{class:"flex items-center gap-2"},{default:c(()=>[s(e(Q),{class:"size-5"}),d(" "+n(e(t)("tickets.ticket_info")),1)]),_:1}),s(e(q),null,{default:c(()=>[d(n(e(t)("tickets.edit_info_description")),1)]),_:1})]),_:1}),s(e(B),{class:"space-y-4"},{default:c(()=>[l("div",Oe,[l("div",Be,[s(e(k),null,{default:c(()=>[d(n(e(t)("tickets.number")),1)]),_:1}),s(e(H),{"model-value":v.ticket.number,disabled:""},null,8,["model-value"]),l("p",qe,n(e(t)("tickets.number_readonly")),1)]),l("div",Ae,[s(e(k),null,{default:c(()=>[d(n(e(t)("tickets.date")),1)]),_:1}),s(e(H),{modelValue:e(a).date,"onUpdate:modelValue":r[0]||(r[0]=i=>e(a).date=i),type:"date",disabled:e(a).processing},null,8,["modelValue","disabled"]),e(a).errors.date?(m(),_("p",Ie,n(e(a).errors.date),1)):x("",!0)]),l("div",Le,[s(e(k),null,{default:c(()=>[d(n(e(t)("tickets.vendor")),1)]),_:1}),s(e(J),{modelValue:e(a).vendor_id,"onUpdate:modelValue":r[1]||(r[1]=i=>e(a).vendor_id=i),options:I.value,placeholder:e(t)("tickets.select_vendor"),disabled:e(a).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(a).errors.vendor_id?(m(),_("p",Me,n(e(a).errors.vendor_id),1)):x("",!0)]),l("div",Pe,[s(e(k),null,{default:c(()=>[d(n(e(t)("tickets.contract")),1)]),_:1}),s(e(J),{modelValue:e(a).contract_id,"onUpdate:modelValue":r[2]||(r[2]=i=>e(a).contract_id=i),key:"ticket-edit-contract-select",options:L.value,placeholder:e(a).vendor_id?e(t)("tickets.select_contract"):e(t)("tickets.select_vendor"),disabled:ee.value,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(a).errors.contract_id?(m(),_("p",Re,n(e(a).errors.contract_id),1)):x("",!0)]),l("div",Ke,[s(e(k),null,{default:c(()=>[d(n(e(t)("tickets.notes")),1)]),_:1}),s(e(he),{modelValue:e(a).notes,"onUpdate:modelValue":r[3]||(r[3]=i=>e(a).notes=i),placeholder:e(t)("tickets.notes_placeholder"),disabled:e(a).processing,rows:3},null,8,["modelValue","placeholder","disabled"]),e(a).errors.notes?(m(),_("p",Xe,n(e(a).errors.notes),1)):x("",!0)]),l("div",Ye,[s(e(ke),{id:"is_active",checked:e(a).is_active,"onUpdate:checked":r[4]||(r[4]=i=>e(a).is_active=i),disabled:e(a).processing},null,8,["checked","disabled"]),s(e(k),{for:"is_active",class:"font-normal"},{default:c(()=>[d(n(e(t)("common.active")),1)]),_:1})])])]),_:1})]),_:1}),s(e(j),null,{default:c(()=>[s(e(N),null,{default:c(()=>[s(e(O),{class:"flex items-center gap-2"},{default:c(()=>[s(e(Se),{class:"size-5"}),d(" "+n(e(t)("tickets.payment_amount")),1)]),_:1}),s(e(q),null,{default:c(()=>[d(n(e(t)("tickets.payment_amount_description")),1)]),_:1})]),_:1}),s(e(B),{class:"space-y-4"},{default:c(()=>[l("div",Ge,[l("div",He,[s(e(k),null,{default:c(()=>[d(n(e(t)("payment_tracker.amount")),1)]),_:1}),s(e(xe),{modelValue:e(a).amount,"onUpdate:modelValue":r[5]||(r[5]=i=>e(a).amount=i),min:0,disabled:e(a).processing||v.ticket.approval_status!=="draft"},null,8,["modelValue","disabled"]),v.ticket.approval_status!=="draft"?(m(),_("p",Je,n(e(t)("tickets.amount_locked")),1)):(m(),_("p",Qe,n(e(t)("tickets.amount_hint")),1)),e(a).errors.amount?(m(),_("p",We,n(e(a).errors.amount),1)):x("",!0)]),l("div",Ze,[s(e(k),null,{default:c(()=>[d(n(e(t)("payment_tracker.approval_status")),1)]),_:1}),s(e(E),{variant:v.ticket.approval_status==="paid"?"default":v.ticket.approval_status==="rejected"?"destructive":"secondary",class:"mt-1"},{default:c(()=>[d(n(e(t)(`payment_tracker.statuses.${v.ticket.approval_status}`)),1)]),_:1},8,["variant"])])]),h.value?(m(),_("div",et,[l("p",tt,n(e(t)("payment_tracker.contract_balance")),1),l("div",st,[l("div",null,[l("p",at,n(e(t)("contracts.amount")),1),l("p",ot,n(V(h.value.amount)),1)]),l("div",null,[l("p",nt,n(e(t)("contracts.total_paid")),1),l("p",it,n(V(h.value.payment_total_paid??0)),1)]),l("div",null,[l("p",lt,n(e(t)("contracts.outstanding_balance")),1),l("p",ct,n(V(h.value.payment_balance??h.value.amount)),1)])]),e(a).amount&&e(a).amount>(h.value.payment_balance??h.value.amount)?(m(),_("div",rt,[s(e(E),{variant:"destructive"},{default:c(()=>[d(n(e(t)("tickets.amount_exceeds_balance")),1)]),_:1})])):x("",!0)])):x("",!0)]),_:1})]),_:1}),s(e(j),null,{default:c(()=>[s(e(N),null,{default:c(()=>[l("div",dt,[l("div",null,[s(e(O),{class:"flex items-center gap-2"},{default:c(()=>[s(e(G),{class:"size-5"}),d(" "+n(e(t)("documents.title")),1)]),_:1}),s(e(q),null,{default:c(()=>[d(n(e(t)("documents.manage_description")),1)]),_:1})]),s(e(ge),{variant:z.value.isComplete?"complete":"incomplete"},{default:c(()=>[d(n(z.value.count)+"/"+n(z.value.total),1)]),_:1},8,["variant"])])]),_:1}),s(e(B),null,{default:c(()=>[l("div",ut,[(m(!0),_(pe,null,fe(e(D),i=>(m(),_("div",{key:i,class:"rounded-lg border p-4 space-y-3"},[l("div",mt,[s(e(k),{class:"font-medium"},{default:c(()=>[d(n(e(t)(`documents.${i}`)),1)]),_:2},1024),s(e(E),{variant:y(i)?"default":"outline",class:"text-xs"},{default:c(()=>[d(n(y(i)?e(t)("status.complete"):e(t)("status.incomplete")),1)]),_:2},1032,["variant"])]),y(i)?(m(),_("div",_t,[l("div",pt,[l("div",ft,[s(e(Q),{class:"size-4 text-primary dark:text-primary/90 mt-0.5 shrink-0"}),l("span",vt,n(y(i).original_name),1)])]),l("div",kt,[l("a",{href:e(Ve)(y(i).id).url,target:"_blank",class:"inline-flex items-center justify-center gap-1.5 flex-1 h-8 text-xs rounded-md border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 transition-colors px-3"},[s(e(Ue),{class:"size-3.5"}),d(" "+n(e(t)("common.preview")),1)],8,xt),s(e(U),{type:"button",variant:"destructive",size:"sm",class:"h-8 px-3",disabled:w.value===y(i).id,onClick:$=>ne(y(i))},{default:c(()=>[s(e(ze),{class:"size-3.5"})]),_:1},8,["disabled","onClick"])])])):(m(),_("div",bt,[s(e(be),{"model-value":P.value[i],disabled:T.value===i,accept:".pdf,.jpg,.jpeg,.png","max-size":10240,"onUpdate:modelValue":$=>oe(i,$)},null,8,["model-value","disabled","onUpdate:modelValue"]),T.value===i?(m(),_("div",gt,[s(e(G),{class:"size-3.5"}),d(" "+n(e(t)("common.uploading")),1)])):x("",!0)]))]))),128))]),l("p",ht,n(e(t)("documents.fileTypes")),1)]),_:1})]),_:1}),l("div",yt,[s(e(U),{type:"button",variant:"outline",onClick:M,disabled:e(a).processing},{default:c(()=>[d(n(e(t)("common.cancel")),1)]),_:1},8,["disabled"]),s(e(U),{type:"submit",disabled:e(a).processing},{default:c(()=>[s(e(Ee),{class:"mr-2 size-4"}),d(" "+n(e(a).processing?e(t)("common.saving"):e(t)("common.save")),1)]),_:1},8,["disabled"])])],32)]),s(X,{open:e(p).open,"onUpdate:open":r[6]||(r[6]=i=>e(p).open=i),title:e(p).title,description:e(p).description,"confirm-text":e(p).confirmText,"cancel-text":e(p).cancelText,destructive:e(p).destructive,details:e(p).details,onConfirm:e(p).confirm,onCancel:e(p).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"]),s(X,{open:e(f).open,"onUpdate:open":r[7]||(r[7]=i=>e(f).open=i),title:e(f).title,description:e(f).description,"confirm-text":e(f).confirmText,"cancel-text":e(f).cancelText,destructive:e(f).destructive,details:e(f).details,onConfirm:e(f).confirm,onCancel:e(f).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"])]),_:1},8,["breadcrumbs"]))}});export{ss as default};
