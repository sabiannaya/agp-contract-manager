import{d as et,u as st,o as ot,a as at,r as U,w as P,c as y,b as c,e as o,f as t,h as nt,g as e,i as d,j as u,t as s,k as f,m,F as z,p as F,l as ct,n as rt,q as I,s as D}from"./app-CuI7LdXL.js";import{_ as lt}from"./Heading.vue_vue_type_script_setup_true_lang-BHjUqA3V.js";import{_ as h}from"./index-D_NX9Eof.js";import{_ as M}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BUBYiqAX.js";import{_ as k,a as V,b as $,c as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-BhpnJ5ya.js";import{_ as dt}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-BsyeBIW3.js";import{_ as it,a as ut,b as mt,c as _t,d as pt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C-SfElTY.js";import{_ as ft}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Bw_2LaqB.js";import{_ as j}from"./Input.vue_vue_type_script_setup_true_lang-DLaguvqt.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-BVYJy_EQ.js";import{_ as N}from"./Select.vue_vue_type_script_setup_true_lang-QPZrs6lE.js";import{_ as q}from"./StatusBadge.vue_vue_type_script_setup_true_lang-MmS8OP8w.js";import{u as vt}from"./useDateFormat-BThD_v7S.js";import{i as A,F as L,d as gt,u as xt,h as ht,l as yt,e as bt}from"./AppLayout.vue_vue_type_script_setup_true_lang-CwkbJi7E.js";import{A as kt}from"./arrow-left-DWqgfXPD.js";import{P as Vt}from"./pencil-CZinZyQI.js";import{C as $t}from"./calendar-B76Vfs4p.js";import{U as wt}from"./user-DjvsFMWj.js";import{S as Ct}from"./shield-check-CY15T8OL.js";import"./index-BRm__Hk1.js";import"./useForwardPropsEmits-CaKxx7wQ.js";import"./useForwardExpose-D4WvoR71.js";import"./VisuallyHidden-DxCKGmrj.js";import"./VisuallyHiddenInput-8nto7-pU.js";import"./chevron-down-DGBHzGpy.js";import"./createLucideIcon-CX-op3lg.js";import"./check-CLJgvc3L.js";import"./index-BDqSilVs.js";const Ut={class:"flex h-full flex-1 flex-col gap-6 p-6"},zt={class:"flex items-center justify-between"},Ft={class:"flex items-center gap-4"},Dt={class:"flex items-center gap-2"},Mt={class:"grid gap-6 lg:grid-cols-2"},jt={class:"grid gap-4 sm:grid-cols-2"},Nt={class:"text-muted-foreground text-sm"},St={class:"font-medium"},Bt={class:"text-muted-foreground text-sm"},Et={class:"font-medium"},Ot={class:"text-muted-foreground text-sm"},Tt={class:"text-lg font-semibold"},Pt={class:"text-muted-foreground text-sm"},It={key:0,class:"border-t pt-4"},qt={class:"text-muted-foreground mb-2 text-sm"},At={key:0,class:"flex flex-wrap gap-2"},Lt={key:1,class:"text-muted-foreground text-sm"},Rt={class:"grid gap-4 sm:grid-cols-2"},Gt={class:"text-muted-foreground text-sm"},Ht={class:"font-medium"},Jt={class:"text-muted-foreground text-sm"},Kt={class:"font-medium"},Qt={key:0,class:"sm:col-span-2"},Wt={class:"text-muted-foreground text-sm"},Xt={class:"font-medium"},Yt={key:1},Zt={class:"text-muted-foreground text-sm"},te={class:"font-medium"},ee={key:2},se={class:"text-muted-foreground text-sm"},oe={class:"font-medium"},ae={key:0,class:"divide-y"},ne=["onClick"],ce={class:"flex items-center gap-4"},re={class:"font-medium"},le={class:"text-muted-foreground text-sm"},de={class:"flex items-center gap-4"},ie={key:1,class:"text-muted-foreground py-8 text-center"},ue={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},me={class:"text-muted-foreground text-sm"},_e={class:"font-medium"},pe={class:"text-muted-foreground text-sm"},fe={class:"font-medium"},ve={class:"text-muted-foreground text-sm"},ge={class:"font-medium"},xe={class:"text-muted-foreground text-sm"},he={class:"font-medium"},ye={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},be={class:"text-muted-foreground text-sm"},ke={class:"text-lg font-semibold"},Ve={class:"text-muted-foreground text-sm"},$e={class:"text-lg font-semibold text-green-600"},we={class:"text-muted-foreground text-sm"},Ce={class:"text-lg font-semibold text-orange-600"},Ue={class:"text-muted-foreground text-sm"},ze={class:"space-y-1"},Fe={class:"font-medium"},De={key:0,class:"font-medium"},Me={key:0,class:"mt-4 border-t pt-4"},je={class:"text-muted-foreground mb-2 text-sm font-medium"},Ne={class:"flex flex-wrap gap-2"},Se={class:"grid gap-4"},Be={class:"grid grid-cols-2 gap-4"},Ee={class:"space-y-2"},Oe={key:0,class:"text-sm text-destructive"},Te={class:"space-y-2"},Pe={key:0,class:"text-sm text-destructive"},Ie={class:"space-y-2"},qe={key:0,class:"text-sm text-destructive"},Ae={class:"grid grid-cols-2 gap-4"},Le={class:"space-y-2"},Re={key:0,class:"text-sm text-destructive"},Ge={class:"space-y-2"},He={key:0,class:"text-sm text-destructive"},Je={class:"space-y-2"},Ke={class:"text-xs text-muted-foreground"},Qe={key:0,class:"text-sm text-destructive"},We={key:0,class:"space-y-4 border rounded-lg p-4"},Xe={class:"space-y-2"},Ye={key:0,class:"text-sm text-destructive"},Ze={key:0,class:"space-y-2"},ts={class:"flex items-center justify-between"},es={class:"grid grid-cols-4 gap-2"},ss={class:"relative"},os={key:0,class:"text-sm text-destructive"},js=et({__name:"Show",props:{contract:{},eligibleMasters:{}},setup(r){const p=r,{t:n}=st(),{formatDateOnly:S,formatDateTime:B}=vt(),{canUpdate:R}=xt(),G=[{title:n("nav.contracts"),href:A().url},{title:p.contract.number,href:"#"}];function H(){I.get(A().url)}function C(_){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(_)}function J(_){I.get(ht(_).url)}const E=U([]),O=U(!1);async function K(){O.value=!0;try{const _=await fetch(yt().url);E.value=await _.json()}finally{O.value=!1}}ot(K);const Q=D(()=>E.value.map(_=>({value:_.id,label:`${_.code} - ${_.name}`}))),W=D(()=>[{value:"routine",label:n("contracts.types.routine")},{value:"progress",label:n("contracts.types.progress")}]),X=D(()=>(p.eligibleMasters??[]).map(_=>({value:_.id,label:`${_.name} (${_.email})`}))),b=U(!1),a=at({number:p.contract.number,date:p.contract.date,vendor_id:p.contract.vendor_id,amount:p.contract.amount,cooperation_type:p.contract.cooperation_type,term_count:p.contract.term_count,term_percentages:p.contract.term_percentages??[],is_active:p.contract.is_active,assigned_master_user_id:p.contract.assigned_master_user_id??null}),v=U(p.contract.term_percentages??[]);P(()=>a.term_count,_=>{if(_&&_>0){const i=[...v.value];if(_>i.length)for(let l=i.length;l<_;l++)i.push(0);else i.splice(_);v.value=i,a.term_percentages=i}else v.value=[],a.term_percentages=[]}),P(v,_=>{a.term_percentages=[..._]},{deep:!0});const T=D(()=>v.value.reduce((_,i)=>_+(i||0),0));function Y(){a.number=p.contract.number,a.date=p.contract.date,a.vendor_id=p.contract.vendor_id,a.amount=p.contract.amount,a.cooperation_type=p.contract.cooperation_type,a.term_count=p.contract.term_count,a.term_percentages=p.contract.term_percentages??[],v.value=p.contract.term_percentages??[],a.is_active=p.contract.is_active,a.assigned_master_user_id=p.contract.assigned_master_user_id??null,a.clearErrors(),b.value=!0}function Z(){a.put(bt(p.contract.id).url,{onSuccess:()=>{b.value=!1}})}return(_,i)=>(d(),y(gt,{breadcrumbs:G},{default:c(()=>[o(t(nt),{title:`${t(n)("contracts.contract")} - ${r.contract.number}`},null,8,["title"]),e("div",Ut,[e("div",zt,[e("div",Ft,[o(t(M),{variant:"outline",size:"icon",onClick:H},{default:c(()=>[o(t(kt),{class:"size-4"})]),_:1}),o(lt,{title:r.contract.number,description:t(n)("contracts.contract_details")},null,8,["title","description"])]),e("div",Dt,[o(t(q),{active:r.contract.is_active},null,8,["active"]),t(R)("contracts")?(d(),y(t(M),{key:0,onClick:Y},{default:c(()=>[o(t(Vt),{class:"mr-2 size-4"}),u(" "+s(t(n)("common.edit")),1)]),_:1})):f("",!0)])]),e("div",Mt,[o(t(k),null,{default:c(()=>[o(t(V),null,{default:c(()=>[o(t($),null,{default:c(()=>[u(s(t(n)("contracts.contract_info")),1)]),_:1})]),_:1}),o(t(w),{class:"space-y-4"},{default:c(()=>[e("div",jt,[e("div",null,[e("p",Nt,s(t(n)("contracts.contract_number")),1),e("p",St,s(r.contract.number),1)]),e("div",null,[e("p",Bt,s(t(n)("contracts.date")),1),e("p",Et,s(t(S)(r.contract.date)),1)]),e("div",null,[e("p",Ot,s(t(n)("contracts.amount")),1),e("p",Tt,s(C(r.contract.amount)),1)]),e("div",null,[e("p",Pt,s(t(n)("contracts.cooperation_type")),1),o(t(h),{variant:r.contract.cooperation_type==="progress"?"default":"secondary"},{default:c(()=>[u(s(t(n)(`contracts.cooperation_types.${r.contract.cooperation_type}`)),1)]),_:1},8,["variant"])])]),r.contract.cooperation_type==="progress"?(d(),m("div",It,[e("p",qt,s(t(n)("contracts.term_percentages")),1),r.contract.term_percentages?.length?(d(),m("div",At,[(d(!0),m(z,null,F(r.contract.term_percentages,(l,x)=>(d(),y(t(h),{key:x,variant:"outline"},{default:c(()=>[u(s(t(n)("contracts.term_n",{n:x+1}))+": "+s(l)+"% ",1)]),_:2},1024))),128))])):(d(),m("p",Lt,"-"))])):f("",!0)]),_:1})]),_:1}),r.contract.vendor?(d(),y(t(k),{key:0},{default:c(()=>[o(t(V),null,{default:c(()=>[o(t($),null,{default:c(()=>[u(s(t(n)("contracts.vendor_info")),1)]),_:1})]),_:1}),o(t(w),{class:"space-y-4"},{default:c(()=>[e("div",Rt,[e("div",null,[e("p",Gt,s(t(n)("vendors.code")),1),e("p",Ht,s(r.contract.vendor.code),1)]),e("div",null,[e("p",Jt,s(t(n)("vendors.name")),1),e("p",Kt,s(r.contract.vendor.name),1)]),r.contract.vendor.address?(d(),m("div",Qt,[e("p",Wt,s(t(n)("vendors.address")),1),e("p",Xt,s(r.contract.vendor.address),1)])):f("",!0),r.contract.vendor.contact_person?(d(),m("div",Yt,[e("p",Zt,s(t(n)("vendors.contact_person")),1),e("p",te,s(r.contract.vendor.contact_person),1)])):f("",!0),r.contract.vendor.tax_id?(d(),m("div",ee,[e("p",se,s(t(n)("vendors.tax_id")),1),e("p",oe,s(r.contract.vendor.tax_id),1)])):f("",!0)])]),_:1})]),_:1})):f("",!0)]),o(t(k),null,{default:c(()=>[o(t(V),null,{default:c(()=>[o(t($),{class:"flex items-center gap-2"},{default:c(()=>[o(t(L),{class:"size-5"}),u(" "+s(t(n)("contracts.related_tickets"))+" ",1),o(t(h),{variant:"secondary"},{default:c(()=>[u(s(r.contract.tickets?.length||0),1)]),_:1})]),_:1})]),_:1}),o(t(w),null,{default:c(()=>[r.contract.tickets?.length?(d(),m("div",ae,[(d(!0),m(z,null,F(r.contract.tickets,l=>(d(),m("div",{key:l.id,class:"flex cursor-pointer items-center justify-between py-4 transition-colors hover:bg-muted/50",onClick:x=>J(l.id)},[e("div",ce,[e("div",null,[e("p",re,s(l.number),1),e("p",le,[o(t($t),{class:"mr-1 inline size-3"}),u(" "+s(t(S)(l.date)),1)])])]),e("div",de,[l.documents?.length?(d(),y(t(h),{key:0,variant:"outline"},{default:c(()=>[u(s(l.documents.length)+" "+s(t(n)("documents.documents")),1)]),_:2},1024)):f("",!0),o(t(q),{active:l.status==="complete","active-text":t(n)("tickets.status_types.complete"),"inactive-text":t(n)("tickets.status_types.incomplete")},null,8,["active","active-text","inactive-text"])])],8,ne))),128))])):(d(),m("div",ie,[o(t(L),{class:"mx-auto mb-2 size-8 opacity-50"}),e("p",null,s(t(n)("contracts.no_tickets")),1)]))]),_:1})]),_:1}),o(t(k),null,{default:c(()=>[o(t(V),null,{default:c(()=>[o(t($),{class:"flex items-center gap-2"},{default:c(()=>[o(t(wt),{class:"size-5"}),u(" "+s(t(n)("common.audit_info")),1)]),_:1})]),_:1}),o(t(w),null,{default:c(()=>[e("div",ue,[e("div",null,[e("p",me,s(t(n)("common.created_by")),1),e("p",_e,s(r.contract.created_by?.name||"-"),1)]),e("div",null,[e("p",pe,s(t(n)("common.created_at")),1),e("p",fe,s(t(B)(r.contract.created_at)),1)]),e("div",null,[e("p",ve,s(t(n)("common.updated_by")),1),e("p",ge,s(r.contract.updated_by?.name||"-"),1)]),e("div",null,[e("p",xe,s(t(n)("common.updated_at")),1),e("p",he,s(t(B)(r.contract.updated_at)),1)])])]),_:1})]),_:1}),o(t(k),null,{default:c(()=>[o(t(V),null,{default:c(()=>[o(t($),{class:"flex items-center gap-2"},{default:c(()=>[o(t(Ct),{class:"size-5"}),u(" "+s(t(n)("contracts.payment_summary")),1)]),_:1})]),_:1}),o(t(w),null,{default:c(()=>[e("div",ye,[e("div",null,[e("p",be,s(t(n)("contracts.amount")),1),e("p",ke,s(C(r.contract.amount)),1)]),e("div",null,[e("p",Ve,s(t(n)("contracts.total_paid")),1),e("p",$e,s(C(r.contract.payment_total_paid??0)),1)]),e("div",null,[e("p",we,s(t(n)("contracts.outstanding_balance")),1),e("p",Ce,s(C(r.contract.payment_balance??r.contract.amount)),1)]),e("div",null,[e("p",Ue,s(t(n)("contracts.contract_master")),1),e("div",ze,[e("p",Fe,[u(s(r.contract.created_by?.name||"-")+" ",1),o(t(h),{variant:"outline",class:"ml-1 text-xs"},{default:c(()=>[u(s(t(n)("contracts.creator")),1)]),_:1})]),r.contract.assigned_master?(d(),m("p",De,[u(s(r.contract.assigned_master?.name)+" ",1),o(t(h),{variant:"outline",class:"ml-1 text-xs"},{default:c(()=>[u(s(t(n)("contracts.assigned")),1)]),_:1})])):f("",!0)])])]),r.contract.approvers?.length?(d(),m("div",Me,[e("p",je,s(t(n)("contracts.approvers")),1),e("div",Ne,[(d(!0),m(z,null,F(r.contract.approvers,l=>(d(),y(t(h),{key:l.id,variant:"secondary"},{default:c(()=>[u(" #"+s(l.sequence_no)+" "+s(l.user?.name),1)]),_:2},1024))),128))])])):f("",!0)]),_:1})]),_:1})]),o(t(it),{open:b.value,"onUpdate:open":i[8]||(i[8]=l=>b.value=l)},{default:c(()=>[o(t(ut),{class:"sm:max-w-[600px]"},{default:c(()=>[o(t(mt),null,{default:c(()=>[o(t(_t),null,{default:c(()=>[u(s(t(n)("contracts.edit")),1)]),_:1}),o(t(pt),null,{default:c(()=>[u(s(t(n)("contracts.edit_description")),1)]),_:1})]),_:1}),e("form",{onSubmit:ct(Z,["prevent"]),class:"space-y-4"},[e("div",Se,[e("div",Be,[e("div",Ee,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.number")),1)]),_:1}),o(t(j),{modelValue:t(a).number,"onUpdate:modelValue":i[0]||(i[0]=l=>t(a).number=l),disabled:t(a).processing},null,8,["modelValue","disabled"]),t(a).errors.number?(d(),m("p",Oe,s(t(a).errors.number),1)):f("",!0)]),e("div",Te,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.date")),1)]),_:1}),o(t(j),{modelValue:t(a).date,"onUpdate:modelValue":i[1]||(i[1]=l=>t(a).date=l),type:"date",disabled:t(a).processing},null,8,["modelValue","disabled"]),t(a).errors.date?(d(),m("p",Pe,s(t(a).errors.date),1)):f("",!0)])]),e("div",Ie,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.vendor")),1)]),_:1}),o(t(N),{modelValue:t(a).vendor_id,"onUpdate:modelValue":i[2]||(i[2]=l=>t(a).vendor_id=l),options:Q.value,placeholder:t(n)("contracts.select_vendor"),disabled:t(a).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),t(a).errors.vendor_id?(d(),m("p",qe,s(t(a).errors.vendor_id),1)):f("",!0)]),e("div",Ae,[e("div",Le,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.amount")),1)]),_:1}),o(t(dt),{modelValue:t(a).amount,"onUpdate:modelValue":i[3]||(i[3]=l=>t(a).amount=l),min:0,disabled:t(a).processing},null,8,["modelValue","disabled"]),t(a).errors.amount?(d(),m("p",Re,s(t(a).errors.amount),1)):f("",!0)]),e("div",Ge,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.cooperation_type")),1)]),_:1}),o(t(N),{modelValue:t(a).cooperation_type,"onUpdate:modelValue":i[4]||(i[4]=l=>t(a).cooperation_type=l),options:W.value,disabled:t(a).processing},null,8,["modelValue","options","disabled"]),t(a).errors.cooperation_type?(d(),m("p",He,s(t(a).errors.cooperation_type),1)):f("",!0)])]),e("div",Je,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.assigned_master")),1)]),_:1}),o(t(N),{modelValue:t(a).assigned_master_user_id,"onUpdate:modelValue":i[5]||(i[5]=l=>t(a).assigned_master_user_id=l),options:X.value,placeholder:t(n)("contracts.select_master"),disabled:t(a).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e("p",Ke,s(t(n)("contracts.master_hint")),1),t(a).errors.assigned_master_user_id?(d(),m("p",Qe,s(t(a).errors.assigned_master_user_id),1)):f("",!0)]),t(a).cooperation_type==="progress"?(d(),m("div",We,[e("div",Xe,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.term_count")),1)]),_:1}),o(t(j),{"model-value":t(a).term_count??void 0,"onUpdate:modelValue":i[6]||(i[6]=l=>t(a).term_count=l?Number(l):null),type:"number",min:"1",max:"12",disabled:t(a).processing},null,8,["model-value","disabled"]),t(a).errors.term_count?(d(),m("p",Ye,s(t(a).errors.term_count),1)):f("",!0)]),t(a).term_count&&t(a).term_count>0?(d(),m("div",Ze,[e("div",ts,[o(t(g),null,{default:c(()=>[u(s(t(n)("contracts.term_percentages")),1)]),_:1}),e("span",{class:rt(["text-sm font-medium",T.value===100?"text-green-600":"text-destructive"])},s(t(n)("contracts.total"))+": "+s(T.value)+"% ",3)]),e("div",es,[(d(!0),m(z,null,F(v.value,(l,x)=>(d(),m("div",{key:x,class:"space-y-1"},[o(t(g),{class:"text-xs text-muted-foreground"},{default:c(()=>[u(s(t(n)("contracts.term"))+" "+s(x+1),1)]),_:2},1024),e("div",ss,[o(t(j),{modelValue:v.value[x],"onUpdate:modelValue":tt=>v.value[x]=tt,modelModifiers:{number:!0},type:"number",min:"0",max:"100",class:"pr-6",disabled:t(a).processing},null,8,["modelValue","onUpdate:modelValue","disabled"]),i[9]||(i[9]=e("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-sm text-muted-foreground"},"%",-1))])]))),128))]),t(a).errors.term_percentages?(d(),m("p",os,s(t(a).errors.term_percentages),1)):f("",!0)])):f("",!0)])):f("",!0)]),o(t(ft),null,{default:c(()=>[o(t(M),{type:"button",variant:"outline",onClick:i[7]||(i[7]=l=>b.value=!1),disabled:t(a).processing},{default:c(()=>[u(s(t(n)("common.cancel")),1)]),_:1},8,["disabled"]),o(t(M),{type:"submit",disabled:t(a).processing},{default:c(()=>[u(s(t(a).processing?t(n)("common.saving"):t(n)("common.save")),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),_:1}))}});export{js as default};
