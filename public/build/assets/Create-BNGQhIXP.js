import{d as P,u as q,a as L,w as F,c as M,b as l,e as o,f as e,h as R,g as n,i as G,j as d,t as a,k as m,l as p,m as f,p as v,s as g}from"./app-Az55F6M8.js";import{_ as H,u as J}from"./useActionConfirmation-BPstB5Uy.js";import{_ as K}from"./Heading.vue_vue_type_script_setup_true_lang-DzT-PsX3.js";import{_ as Q}from"./index-BLT0FxeU.js";import{_ as h}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjG2TDFh.js";import{_ as y,a as T,b as U,c as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-DL5VZqU4.js";import{_ as z}from"./CardDescription.vue_vue_type_script_setup_true_lang-xuWwyfVh.js";import{_ as W}from"./Checkbox.vue_vue_type_script_setup_true_lang-pmgtftpc.js";import{_ as X}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-MgtW0iPC.js";import{_ as Y}from"./Input.vue_vue_type_script_setup_true_lang-9NyD3cCB.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-BatJIAlb.js";import{_ as B}from"./Select.vue_vue_type_script_setup_true_lang-C5fkymIU.js";import{_ as Z}from"./Textarea.vue_vue_type_script_setup_true_lang-DKZzY7Db.js";import{u as ee,F as te,_ as se,w as $,x as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyTogOSr.js";import{A as ae}from"./arrow-left-DLIy3lRN.js";import{D as ie}from"./dollar-sign-r0xfU81d.js";import{P as ne}from"./plus-Rxuc06gk.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-D7dEZzdR.js";import"./useForwardPropsEmits-DcGYh6Gw.js";import"./index-Dwg1ok0u.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CpvOfIA5.js";import"./VisuallyHidden-C4XAoWlX.js";import"./VisuallyHiddenInput-dytHPRwB.js";import"./useForwardExpose-Dz4tKeCh.js";import"./check-CBSXup_1.js";import"./createLucideIcon-iLJQO7DH.js";import"./chevron-down-DzsoBm0Z.js";import"./index-BDqSilVs.js";const ce={class:"flex h-full flex-1 flex-col gap-6 p-6"},le={class:"flex items-center gap-4"},re={class:"grid gap-4 sm:grid-cols-2"},de={class:"space-y-2"},ue={key:0,class:"text-sm text-destructive"},me={class:"space-y-2"},_e={key:0,class:"text-sm text-destructive"},pe={class:"space-y-2"},fe={key:0,class:"text-sm text-destructive"},ve={class:"space-y-2 sm:col-span-2"},be={key:0,class:"text-sm text-destructive"},ke={class:"flex items-center space-x-2"},xe={class:"grid gap-4 sm:grid-cols-2"},ge={class:"space-y-2"},he={class:"text-xs text-muted-foreground"},ye={key:0,class:"text-sm text-destructive"},Ve={key:0,class:"rounded-lg border bg-muted/30 p-4"},$e={class:"mb-3 text-sm font-medium"},Ce={class:"grid gap-3 sm:grid-cols-3"},we={class:"text-muted-foreground text-xs"},De={class:"font-semibold"},Se={class:"text-muted-foreground text-xs"},Fe={class:"font-semibold text-green-600"},Te={class:"text-muted-foreground text-xs"},Ue={class:"font-semibold text-orange-600"},ze={key:0,class:"mt-3"},Be={class:"text-sm text-blue-800 dark:text-blue-200"},Ne={class:"flex items-center justify-end gap-4"},rt=P({__name:"Create",props:{vendors:{},contracts:{}},setup(N){const k=N,{t:s}=q(),C=ee(),u=J(),I=v(()=>[{title:s("nav.tickets"),href:$().url},{title:s("tickets.create"),href:"#"}]),A=v(()=>t.vendor_id?k.contracts.filter(i=>i.vendor_id===t.vendor_id):[]),w=v(()=>k.vendors.map(i=>({value:i.id,label:`${i.code} - ${i.name}`}))),D=v(()=>A.value.map(i=>({value:i.id,label:i.number}))),O=v(()=>t.processing||!t.vendor_id),t=L({date:new Date().toISOString().split("T")[0],contract_id:null,vendor_id:null,amount:null,reference_no:"",replaces_ticket_id:null,notes:"",is_active:!0}),_=v(()=>t.contract_id?k.contracts.find(i=>i.id===t.contract_id)??null:null);function x(i){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i)}F(()=>t.vendor_id,i=>{if(!i){t.contract_id=null;return}if(i&&t.contract_id){const c=k.contracts.find(r=>r.id===t.contract_id);c&&c.vendor_id!==i&&(t.contract_id=null)}}),F(()=>t.contract_id,i=>{if(i){const c=k.contracts.find(r=>r.id===i);c&&(t.vendor_id=c.vendor_id)}});function S(){g.get($().url)}function j(){t.post(oe().url,{preserveScroll:!0,onSuccess:i=>{C.success(s("tickets.created_successfully"));const c=i.props?.ticket?.id;c?g.visit(`/tickets/${c}/edit`):g.visit($().url)},onError:()=>{C.error(s("tickets.create_failed"))}})}function E(){u.requestConfirmation({title:s("common.create"),description:s("tickets.create_description"),confirmText:s("tickets.create"),details:[{label:s("tickets.vendor"),value:w.value.find(i=>i.value===t.vendor_id)?.label??"-"},{label:s("tickets.contract"),value:D.value.find(i=>i.value===t.contract_id)?.label??"-"},{label:s("payment_tracker.amount"),value:t.amount?x(t.amount):"-"}]},j)}return(i,c)=>(m(),M(se,{breadcrumbs:I.value},{default:l(()=>[o(e(R),{title:e(s)("tickets.create")},null,8,["title"]),n("div",ce,[n("div",le,[o(e(h),{variant:"outline",size:"icon",onClick:S},{default:l(()=>[o(e(ae),{class:"size-4"})]),_:1}),o(K,{title:e(s)("tickets.create"),description:e(s)("tickets.create_description")},null,8,["title","description"])]),n("form",{onSubmit:G(E,["prevent"]),class:"space-y-6"},[o(e(y),null,{default:l(()=>[o(e(T),null,{default:l(()=>[o(e(U),{class:"flex items-center gap-2"},{default:l(()=>[o(e(te),{class:"size-5"}),d(" "+a(e(s)("tickets.ticket_info")),1)]),_:1}),o(e(z),null,{default:l(()=>[d(a(e(s)("tickets.create_info_description")),1)]),_:1})]),_:1}),o(e(V),{class:"space-y-4"},{default:l(()=>[n("div",re,[n("div",de,[o(e(b),null,{default:l(()=>[d(a(e(s)("tickets.date")),1)]),_:1}),o(e(Y),{modelValue:e(t).date,"onUpdate:modelValue":c[0]||(c[0]=r=>e(t).date=r),type:"date",disabled:e(t).processing},null,8,["modelValue","disabled"]),e(t).errors.date?(m(),p("p",ue,a(e(t).errors.date),1)):f("",!0)]),n("div",me,[o(e(b),null,{default:l(()=>[d(a(e(s)("tickets.vendor")),1)]),_:1}),o(e(B),{modelValue:e(t).vendor_id,"onUpdate:modelValue":c[1]||(c[1]=r=>e(t).vendor_id=r),options:w.value,placeholder:e(s)("tickets.select_vendor"),disabled:e(t).processing,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(t).errors.vendor_id?(m(),p("p",_e,a(e(t).errors.vendor_id),1)):f("",!0)]),n("div",pe,[o(e(b),null,{default:l(()=>[d(a(e(s)("tickets.contract")),1)]),_:1}),o(e(B),{modelValue:e(t).contract_id,"onUpdate:modelValue":c[2]||(c[2]=r=>e(t).contract_id=r),key:"ticket-create-contract-select",options:D.value,placeholder:e(t).vendor_id?e(s)("tickets.select_contract"):e(s)("tickets.select_vendor"),disabled:O.value,clearable:""},null,8,["modelValue","options","placeholder","disabled"]),e(t).errors.contract_id?(m(),p("p",fe,a(e(t).errors.contract_id),1)):f("",!0)]),n("div",ve,[o(e(b),null,{default:l(()=>[d(a(e(s)("tickets.notes")),1)]),_:1}),o(e(Z),{modelValue:e(t).notes,"onUpdate:modelValue":c[3]||(c[3]=r=>e(t).notes=r),placeholder:e(s)("tickets.notes_placeholder"),disabled:e(t).processing,rows:3},null,8,["modelValue","placeholder","disabled"]),e(t).errors.notes?(m(),p("p",be,a(e(t).errors.notes),1)):f("",!0)]),n("div",ke,[o(e(W),{id:"is_active",checked:e(t).is_active,"onUpdate:checked":c[4]||(c[4]=r=>e(t).is_active=r),disabled:e(t).processing},null,8,["checked","disabled"]),o(e(b),{for:"is_active",class:"font-normal"},{default:l(()=>[d(a(e(s)("common.active")),1)]),_:1})])])]),_:1})]),_:1}),o(e(y),null,{default:l(()=>[o(e(T),null,{default:l(()=>[o(e(U),{class:"flex items-center gap-2"},{default:l(()=>[o(e(ie),{class:"size-5"}),d(" "+a(e(s)("tickets.payment_amount")),1)]),_:1}),o(e(z),null,{default:l(()=>[d(a(e(s)("tickets.payment_amount_description")),1)]),_:1})]),_:1}),o(e(V),{class:"space-y-4"},{default:l(()=>[n("div",xe,[n("div",ge,[o(e(b),null,{default:l(()=>[d(a(e(s)("payment_tracker.amount")),1)]),_:1}),o(e(X),{modelValue:e(t).amount,"onUpdate:modelValue":c[5]||(c[5]=r=>e(t).amount=r),min:0,disabled:e(t).processing},null,8,["modelValue","disabled"]),n("p",he,a(e(s)("tickets.amount_hint")),1),e(t).errors.amount?(m(),p("p",ye,a(e(t).errors.amount),1)):f("",!0)])]),_.value?(m(),p("div",Ve,[n("p",$e,a(e(s)("payment_tracker.contract_balance")),1),n("div",Ce,[n("div",null,[n("p",we,a(e(s)("contracts.amount")),1),n("p",De,a(x(_.value.amount)),1)]),n("div",null,[n("p",Se,a(e(s)("contracts.total_paid")),1),n("p",Fe,a(x(_.value.payment_total_paid??0)),1)]),n("div",null,[n("p",Te,a(e(s)("contracts.outstanding_balance")),1),n("p",Ue,a(x(_.value.payment_balance??_.value.amount)),1)])]),e(t).amount&&e(t).amount>(_.value.payment_balance??_.value.amount)?(m(),p("div",ze,[o(e(Q),{variant:"destructive"},{default:l(()=>[d(a(e(s)("tickets.amount_exceeds_balance")),1)]),_:1})])):f("",!0)])):f("",!0)]),_:1})]),_:1}),o(e(y),{class:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950"},{default:l(()=>[o(e(V),{class:"p-4"},{default:l(()=>[n("p",Be,a(e(s)("tickets.create_document_info")),1)]),_:1})]),_:1}),n("div",Ne,[o(e(h),{type:"button",variant:"outline",onClick:S,disabled:e(t).processing},{default:l(()=>[d(a(e(s)("common.cancel")),1)]),_:1},8,["disabled"]),o(e(h),{type:"submit",disabled:e(t).processing},{default:l(()=>[o(e(ne),{class:"mr-2 size-4"}),d(" "+a(e(t).processing?e(s)("common.creating"):e(s)("tickets.create")),1)]),_:1},8,["disabled"])])],32)]),o(H,{open:e(u).open.value,"onUpdate:open":c[6]||(c[6]=r=>e(u).open.value=r),title:e(u).title.value,description:e(u).description.value,"confirm-text":e(u).confirmText.value,"cancel-text":e(u).cancelText.value,destructive:e(u).destructive.value,details:e(u).details.value,onConfirm:e(u).confirm,onCancel:e(u).cancel},null,8,["open","title","description","confirm-text","cancel-text","destructive","details","onConfirm","onCancel"])]),_:1},8,["breadcrumbs"]))}});export{rt as default};
